{"version":3,"sources":["icons/fullscreen.png","icons/github.png","icons/settings.png","icons/share.png","icons/info.png","icons/examples.png","icons/materialbrush.png","icons/signalbrush.png","icons/resetmaterials.png","icons/resetfields.png","em/kernels/rendering.ts","em/drawing.ts","em/kernels/simulation.ts","em/simulator.ts","em/index.ts","em/rendering.ts","em/sources.ts","em/serialization.ts","util.ts","components.tsx","em/maps.ts","share.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","blurDirectional","vertDraw","DrawShape","vert","makeDrawSquareInfo","center","halfSize","value","drawShape","Square","makeDrawEllipseInfo","radius","Ellipse","clamp","min","max","Math","snapToGrid","relativePoint","gridSize","relativeCellSize","residual","DoubleFramebuffer2D","current","previous","this","oldCurrent","FDTDSimulator","regl","cellSize","reflectiveBoundary","dt","data","updateMagnetic","updateElectric","updateAlphaBeta","injectSource","decaySource","drawOnTexture","copyUint8ToFloat16","copyFloat16ToUint8","frameBuffers","alphaBetaDt","getGridSize","setGridSize","forEach","frameBuffer","resize","resetFields","getCellSize","setCellSize","getReflectiveBoundary","setReflectiveBoundary","stepElectric","updateAlphaBetaFromMaterial","electricField","swap","electricSourceField","sourceField","field","magneticField","alphaBetaField","time","stepMagnetic","clear","color","framebuffer","resetMaterials","material","drawMaterial","materialType","drawInfo","keep","uniforms","pos","texture","fbo","size","injectSignal","loadMaterial","materialTexture","format","type","mag","destroy","loadMaterialFromComponents","permittivity","permeability","conductivity","width","length","height","y","row","x","push","combineMaterialMaps","getData","getMaterial","wrap","depthStencil","materialData","read","materialFloats","makeFrameBuffer","makeField","makeFragFn","frag","fbos","attributes","position","k","count","primitive","depth","enable","makeFragWithFboPropFn","_","prop","props","createEM","canvas","REGL","extensions","optionalExtensions","createReglFromCanvas","canvasSize","filter","hasExtension","energyFbo","backgroundFbo","renderBackground","renderEnergy","brightness","electricEnergyFactor","magneticEnergyFactor","bloomExtract","threshold","blurVert","direction","ctx","drawingBufferHeight","blurHor","draw","energyTexture","bloomTexture","backgroundTexture","render","showElectric","showMagnetic","i","adjustCanvasSize","poll","adjustGridSize","makeRenderSimulatorCanvas","sim","sources","renderToCanvas","simData","stepSim","inject","getSources","setSources","newSources","newGridSize","getTime","PointSignalSource","amplitude","frequency","turnOffTime","simulator","t","undefined","cos","PI","makeMaterialMap","shape","encodeSimulatorMap","simulatorMap","simulationSettings","sourceDescriptors","encodedMaterialMap","encodeMaterialMap","materialMap","version","decodeSimulatorMap","encodedSimulatorMap","materialMapArray","Float32Array","pako","inflate","buffer","index","decodeMaterialMap_v0","decodeMaterialMap","deflate","Uint8Array","to","toggleFullScreen","document","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","SideBarType","BrushType","qualityPresets","resolutionScale","gridSizeLongest","CollapsibleContainer","collapsed","setCollapsed","id","className","buttonStyle","style","children","title","textAlign","background","fontWeight","onClick","e","float","border","fontSize","cursor","marginTop","LabeledSlider","setValue","allowNegative","logarithmic","displayDigits","absValue","log2","abs","useState","negative","setNegative","rangeSliderRef","useRef","updateValue","useCallback","newValue","parseFloat","pow","useEffect","displayValue","toFixed","label","marginLeft","checked","onChange","target","ref","step","lineHeight","marginBottom","OptionSelector","options","map","option","optionIndex","key","backgroundColor","selectedOption","overflow","textOverflow","setSelectedOption","ExamplesComponent","em","setGridSizeLongest","setDt","setSimulationSpeed","loadMap","loadedSources","desc","Error","simulationSpeed","useMemo","padding","Array","fill","maps","margin","slitCenterX","round","slitSize","isWallRow","permittivityRow","getCurvePoint","sin","thickness","endPoint","isLensPoint","point","dx","dy","SettingsComponent","setResolutionScale","onPresetClicked","preset","Object","keys","presetName","ImageButton","highlight","borderRadius","src","alt","ShareComponent","shareTitle","shareText","shareUrl","shareUrlTextRef","onCopyClicked","select","execCommand","onShareClicked","nav","navigator","share","text","url","then","console","log","catch","err","error","readOnly","MaterialBrushMenu","activeBrushShape","setActiveBrushDrawShape","brushShapeIndex","setBrushShapeIndex","brushSizeLabel","snapInput","setSnapInput","materialBrushSize","setMaterialBrushSize","permittivityBrushValue","setPermittivityBrushValue","permeabilityBrushValue","setPermeabilityBrushValue","conductivityBrushValue","setConductivityBrushValue","SignalBrushMenu","signalBrushSize","setSignalBrushSize","signalBrushValue","setSignalBrushValue","signalFrequency","setSignalFrequency","MultiMenuChild","MultiMenu","activeChildren","child","activateForState","activeState","InfoBox","visible","setVisible","left","right","top","bottom","href","textDecoration","rel","LoadingIndicator","ShareBox","shareInProgress","ResetButtons","extraStyle","Icon","BrushSelectionButtons","setActiveSideBar","SignalBrush","setActiveBrush","Signal","activeSideBar","MaterialBrush","Material","MenuSelectionButtons","Examples","Settings","BrushCursor","cursorStyle","mousePosition","pointerEvents","activeBrushSize","brushShape","MiscButtons","generateShareUrl","setShareVisible","shareVisible","setInfoVisible","infoVisible","InteractiveCanvas","windowToSimulationPoint","activeBrush","mouseDownPos","setIsInputDown","windowSize","setMousePosition","drawCanvasRef","changeMaterial","canvasPos","brushHalfSize","drawingMaterial","setDrawingMaterial","inputStartPos","setInputStartPos","inputDir","setInputDir","onInputDown","clientPos","onInputMove","shiftDown","offset","projection","angleQuantum","snappedAngle","atan2","dir","onInputUp","onMouseDown","clientX","clientY","onMouseMove","shiftKey","onMouseUp","onMouseLeave","onTouchStart","touches","onTouchMove","onTouchEnd","onTouchCancel","onContextMenu","preventDefault","FullscreenView","touchAction","userSelect","apiUrl","shareId","a","fetch","response","ok","responseText","JSON","parse","method","mode","headers","body","stringify","json","responseObject","defaultPreset","defaultBrushDrawShape","initialDt","initialCellSize","initialGridSizeLongest","initialResolutionScale","initialWindowSize","window","innerWidth","innerHeight","initialCanvasSize","calculateCanvasSize","initialGridSize","calculateGridSize","canvasAspect","ceil","urlShareId","location","hash","substr","setShareId","setCanvasSize","setWindowSize","setEm","wndSize","addEventListener","removeEventListener","setShowLoading","getSharedSimulatorMap","descriptor","descriptorToSignalSource","finally","signalStrength","setShareInProgress","sideMenuCollapsed","setSideMenuCollapsed","showLoading","windowPoint","simStep","timer","setInterval","clearInterval","drawStep","cnvSize","stop","requestAnimationFrame","drawIfNotStopped","isInputDown","sideBar","setSideBar","hideWhenInputDownStyle","opacity","shareSimulatorMap","source","signalSourceToDescriptor","origin","pathname","toString","Boolean","hostname","match","ReactDOM","App","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.f64de7b4.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAABmJLR0QA/wD/AP+gvaeTAAACnklEQVR4nO3dy2oUQRjF8fOZmIUXXLoX1EWMAVGCPpQrH0NXrn0FFxEhKiEg6gvoyoVrsxHHGcjFy3HREwRJhnSnqvvL5P+DWTV8VV1nanrRNVUSAAAAAAAAMKdc38j2uu3livdw2/Zr27u1b6Zt36LDzbRupKOJpAcR8bFkUdv3JL2TtFSy7lEiotUYn6vVkQIuSXpcoe4z9RRGF5lniCTtS7oQEb9LFLN9VdLXErWOa55myJmUPZCtUrNDkiJiW9KnUvVqyBzIRNKjCnUfStqpULeIjIGMJK1LWouI4t/miNiStCZpU9Ju6fonVfyh3vYhdtqVHo+MM+RMI5BkCCQZAkmGQJIhkGQIJBkCSYZAkiGQZAgkGQJJhkCSIZBkCCSZLoGMZlz73rUjp9j2jGvjtsW6BPK247V59X7Gtc3qrdtetj0+ZJHeuOZqw6xsX7f944jxuNZXJ1Zsv7K9b3vP9obtW700npDtm7Y3p+Px0/Yb26tDdGTB9kLvDSdle8n24tD9AAAAAAAAAAAAAAAA/7G9yCKHfwYbD9s3pktdfk0/wyx7SWLQ8bC9OmOh3EovnUhk8PGw/fKQxg+8qN6BZEqPR5fNZyaSLh5xeRIRl9vWPM1Kjwe7AZ1Q6fHg/yHJEEgyBJIMgSRDIMkQSDIEkgyBJEMgyRBIMgSSDIEkQyDJEEgyBJJM8UBmvD07rrHt5664T4ib/VrW3ZwIdyKl+5b5DKqRpDsR8aVkUTfvuT+oOXSsunl6QXVF0tMKdZ+opzC6yDxDJGlPzSltf0oUc7NmakfS+RL1jmOeZsiBPr8Ag8seyEZEFAtkeuLbVql6NWT+yfom6X5EfC5ZlId6exM1p7TdLR2GJE3P1l2btjFrQ08AAAAAAHDm/QVKIvrt1bqvIwAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzlFQkFERkU4NkJCMTFFM0FBNTJFRTMzNTJEMUJDNDYiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzlFQkFERkQ4NkJCMTFFM0FBNTJFRTMzNTJEMUJDNDYiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MTc4QTJFOTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU1MTc4QTJGOTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Kk5lQwAABYxJREFUeNrkm29oVXUYx3+7bM3V1FnbqlltrtXWtYRa1nqxooY5E7EhKWGuaTDBagol9SIMDCKICASj+cISw/DPi16ZBakrUBnoC7nNoTMWy6I1c+LmVq6t78N9jpyu555znt855+536IHPi939/jzP95zznN+/kzc1NaUitirwJJgPasF94DZQDG7hMqNgBFwEZ5kU+AH0R+lcXgQCJMBT4EXwLKgM2N7P4FvwJegCk6YKUA5eB23grogu2C/gc7AN/GGKABTsZtAOZqjc2DjYAT5kUfSNBNCkAGwGo1PTZ6PsQ4FuHLp3QD3YDR5QZtgZsAac1ElYokcGbATHDApesS/kUwf7GEkOKAK7wAvKbNsPXgZjYQowG3wNnlDxsONgCbgchgAU/GHwiIqXUT5o8hLBKwfcDA7FMHgrUR/iGLQEoGTyBWhQ8bUGjiFPR4A3QIuKv7VwLKIcQMnue5Dv0fjT/IwtAM3g+RyMBmkU+BXf3qc5Rx3xqDPBE7LjfkaCheCcj1HYKYe6JeBt8GcEo75L3HaJQ7+nfNQ/x7H9p67TFX4L1Pi4EocdfhsGH4BPwVbwqu0xGwI/8vT2N/77Gv+vAJSCO3n6PJ//Vjz72w62cPtORnfAwx7+1nBsW93ugGow7vOKtPkYa9eDl0Clxji9kuvW+yjb5tPncY7xet3MhjoFt2RzgIlU2DQL/O6017W/Be4BawXJqMCgTH+ToOxajvWG1+AmYVBlBglQKrxwmzIFoB9XCzt91CABpL6sti62JcBiXtKS2GMGCSD1pZxjvi7AKmED9PraYJAAG2yvVL+2yi7AImHl90C3QQJ03/B+97ZF1lCYVlN6BBV/BffykNQkoyF4H5grqJOkO6BR2NF2A4O35gifCOs0JjTW9vYaPPPbJ11LJAFqBRVoDf68wQLQI3BBUL424XPiY1lvDOb/ZwRla0iAOYIKv8dAgEFB2VtJgJmCChMxEEAyHigmAQoFFWbFQIDZgrKF0p2hmTEQQOQjCTAmKD8vBgJUCcqOkQBXBBXosEORwcEXKdmBjCskwICgQr5h0+BMW6i8V7LtNkAC9As7WWqwAM8Jy/cnhBMhspVKvq2eC0uwbxLrSWhMa+dpdJQLW6mRpLtpOlyuMcL7CTwErhoSPG2ApjQEuD3BQ0fp0ZJqlT6pZYpt0wieYh60nuWDGp2+At4xIPgt7IvU0jHzBkFdgD27HWDGNGyGFHHfulaXuTN0IkBjZ8EykJeDwKmPFtAXwN8TTltjrVkKfwcawXJW3G3v8DTYCKoiCLwGvAl6QthpbnU6J5jP2f1uh1Wgxbbxwv0qvT/vtZRGA6wuzs50+Pkb8JdgQtPMq1VJld7bnxtSzhjgJD5hzwEW611OZK6xlSvzeYbAsl3Cx4PK7ozodOl6t93hfJByqbzOVnYh+MdHhxfBLI1bnuoMhRx8imPMKgDR5LG/nrSVfddHpx8HeO4/ClmApsw+snXsdk7gYMat+r5Hp0sDCLAkxOA7nfrI1nGxx2tmQUb5x8FuzgvD4Dw4wNm2MIAA1SEF38cx+RaAeBCMZGlwb44GOyUhBD/CsTj24TatpddXq3L+RIVmXnE4QzjJMaSylvBxFdqzKHsVrDD8Dmj36sOvIx0unewHDRENg4MI0BH2FyP0RcZOlzW3Ib7VLvPqDK0z1PEq7bDmLVwCLgnr0AhvnUp/0eJp0k9m6HO4fUp2nGZODgUY5PzUJVlHkxg1TEfnjxqY8I6yb12SSjqLm7T9/Ax4TaW/+JxuIx862KcL4toBk1QFT1omXZLRHQHaL3Npl/r8jH3QjiGsbJ3kGd/fDo6WBWi31KG9a9xXMgzfw35tVfCR9l52dk8Ibe7htnq57YowfY7i4+lYWUL9z+1fAQYACqstE4NCc18AAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAABmJLR0QA/wD/AP+gvaeTAAABpElEQVR4nO3aMU4CURRG4f9Zw26MtdYa41a0McQ96FpQd+FujP21IBQSkYQ43COeryKhuG848zIzZBJJkiT9vrH+UFXVuZD/bowxkuSkeyH6yiAwBoExCIxBYAwCYxAYg8AYBMYgMAaBMQiMQWAMAmMQGIPAGATGIDAGgTEIjEFgDAJjEEmSjsTY9oXv+k5r/S7vJu+yYAwCYxAYg8AYBIYQZJnkPMlsNEkyS3KR5Lnzh/hRHcZ993FuqqrFIQ582/zO55DlGONm4hl7qaqXJFdTziA+hzw1zt7lsWtw5w6ZjzE+Jp6xl6qaJ3mfcgZxh5BtPVGn1hnktHH2Lm1r6wxy2zh7l7uuwZ1Brqtq0Tj/W1X1kOSyaz7h7/fXrO5q3rou8lU1S3KW1c44SIxtF3VCkH/Ju6w/wiAwBoExCIxBYAwCYxAYg8AYBMYgMAaBMQiMQWAMAmMQGIPAGATGIDAGgTEIjEFgDAJjEBiDwBgExiAwBoExCIxBYAwCYxAYg8AYBMYgMAaBMQiMQWAMAmMQGIPAGATGIDAGgTEIjEEkSToSn6mWBDoPoverAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAABmJLR0QA/wD/AP+gvaeTAAABQ0lEQVR4nO3csW0bQRBA0VlXITfmMuRaVIcLI7s4RwQkmKIS+vh1fC/dYAb4yQF72BkAAIB9rc8Otm37NTNvM/OyyyJrfdhl27btSPPeOc/M61rrz7XDW0FOs1OMmacKMjNzXmv9vHZwK8ieCz5bkH/mX/zYcwm+JkiMIDGCxAgSI0iMIDGCxAgSI0iMIDGCxAgSI0iMIABwEHe/Uz/63fi95rlT/yYEiREkRpAYQWIEiREkRpAYQWIEiREkRpAYQWIEiREkRpAYQQDgILzksNO8r+Zf+MqKESRGkBhBYgSJESRGkBhBYgSJESRGkBhBYgSJESRGkBhBYgQBgIPw1smD5vnr5JsQJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQmFtBzrtt8XxOnx3cCvI6ovwPp5n5/eglAAAALv4CjtFYBjakwqUAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","module.exports = \"data:image/png;base64,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\"","export const renderEnergy = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D electricField;\r\n    uniform sampler2D magneticField;\r\n    uniform sampler2D material;\r\n    uniform float brightness;\r\n    uniform float electricEnergyFactor;\r\n    uniform float magneticEnergyFactor;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        vec3 el = texture2D(electricField, uv).rgb;\r\n        vec3 mag = texture2D(magneticField, uv).rgb;\r\n        vec2 mat = texture2D(material, uv).rg;\r\n        float brightnessSquared = brightness * brightness;\r\n\r\n        vec2 energy = vec2(\r\n            electricEnergyFactor * mat.x * dot(el, el),\r\n            magneticEnergyFactor * mat.y * dot(mag, mag)\r\n        );\r\n\r\n        gl_FragColor = vec4(brightnessSquared * energy, 0.0, 0.0);\r\n    }\r\n`\r\n\r\nexport const bloomExtract = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D texture;\r\n    uniform float threshold;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        vec4 col = texture2D(texture, uv);\r\n        gl_FragColor = col * step(threshold, 0.5 * (col.r + col.g));\r\n    }\r\n`\r\n\r\nexport const blurDirectional = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D texture;\r\n    uniform vec2 direction;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        gl_FragColor =\r\n            0.227027 * texture2D(texture, uv) +\r\n            0.1945946 * (texture2D(texture, uv + direction) + texture2D(texture, uv - direction)) +\r\n            0.1216216 * (texture2D(texture, uv + 2.0 * direction) + texture2D(texture, uv - 2.0 * direction)) +\r\n            0.054054 * (texture2D(texture, uv + 3.0 * direction) + texture2D(texture, uv - 3.0 * direction)) +\r\n            0.016216 * (texture2D(texture, uv + 4.0 * direction) + texture2D(texture, uv - 4.0 * direction));\r\n    }\r\n`\r\n\r\nexport const renderBackground = `\r\n    precision highp float;\r\n\r\n    uniform vec2 gridSize;\r\n\r\n    varying vec2 uv;\r\n\r\n    const float sqrtTwoPi = 2.50662827463;\r\n\r\n    void main() {\r\n        vec2 tileFactor = gridSize;\r\n\r\n        // Repeat -0.5..+0.5 sawtooth for as many cells as we have\r\n        vec2 dPermittivity = mod(tileFactor * uv, 1.0) - 0.5;\r\n        vec2 dPermeability = mod(tileFactor * uv + 0.5, 1.0) - 0.5;\r\n        vec2 dConductivity = abs(mod(tileFactor * uv, 1.0) - 0.5);\r\n\r\n        // Calculate distance to repeating center for each pixel.\r\n        // Values will be in [0, 2 * PI]\r\n        vec2 pCircleDists = sqrtTwoPi * vec2(\r\n            dot(dPermittivity, dPermittivity),\r\n            dot(dPermeability, dPermeability)\r\n        );\r\n\r\n        float bgPermittivity = -smoothstep(0.0, 1.0, pCircleDists.x);\r\n        float bgPermeability = -smoothstep(0.0, 1.0, pCircleDists.y);\r\n\r\n        gl_FragColor = vec4(\r\n            bgPermittivity,\r\n            bgPermeability,\r\n            dConductivity.x,\r\n            dConductivity.y\r\n        );\r\n    }\r\n`\r\n\r\nexport const draw = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D energyTexture;\r\n    uniform sampler2D bloomTexture;\r\n    uniform sampler2D materialTexture;\r\n    uniform sampler2D backgroundTexture;\r\n\r\n    varying vec2 uv;\r\n\r\n    const float sqrtTwoPi = 2.50662827463;\r\n\r\n    void main() {\r\n        vec2 energy = texture2D(energyTexture, uv).rg;\r\n        vec2 bloom = texture2D(bloomTexture, uv).rg;\r\n        vec3 material = texture2D(materialTexture, uv).rgb;\r\n        vec4 background = texture2D(backgroundTexture, uv);\r\n\r\n        vec2 pValues = 2.0 / (1.0 + exp(-0.5 * (material.rg - 1.0))) - 1.0;\r\n        float cValue = material.b / 10.0;\r\n\r\n        float bgPermittivity = pValues.x >= 0.1 ? 1.0 + background.r : background.r;\r\n        float bgPermeability = pValues.y >= 0.1 ? 1.0 + background.g : background.g;\r\n        float backgroundConductivity = 0.5 * (cValue >= 0.0 ?\r\n            cValue * smoothstep(0.0, 1.0, background.b) :\r\n            -cValue * smoothstep(0.0, 1.0, background.a)\r\n        );\r\n\r\n        gl_FragColor = vec4(\r\n            min(1.0, backgroundConductivity + 0.8 * bgPermittivity * pValues.x + energy.r + bloom.r),\r\n            min(1.0, backgroundConductivity + bloom.r + bloom.g),\r\n            min(1.0, backgroundConductivity + 0.8 * bgPermeability * pValues.y + energy.g + bloom.g),\r\n            1.0\r\n        );\r\n    }\r\n`\r\n\r\nexport const vertDraw = `\r\n    precision highp float;\r\n    attribute vec2 position;\r\n    varying vec2 uv;\r\n    void main() {\r\n        uv = 0.5 * (position + 1.0);\r\n        gl_Position = vec4(position, 0, 1);\r\n    }\r\n`","export enum DrawShape {\r\n    Square = \"square\",\r\n    Ellipse = \"ellipse\",\r\n}\r\n\r\ntype BaseDrawInfo = {\r\n    drawShape: DrawShape\r\n    center: [number, number]\r\n    value: number\r\n}\r\n\r\ntype DrawSquareInfo = {\r\n    drawShape: DrawShape.Square\r\n    halfSize: [number, number]\r\n} & BaseDrawInfo\r\n\r\ntype DrawCircleInfo = {\r\n    drawShape: DrawShape.Ellipse\r\n    radius: [number, number]\r\n} & BaseDrawInfo\r\n\r\nexport function makeDrawSquareInfo(center: [number, number], halfSize: [number, number], value: number): DrawSquareInfo {\r\n    return {\r\n        drawShape: DrawShape.Square,\r\n        center,\r\n        halfSize: halfSize,\r\n        value\r\n    }\r\n}\r\n\r\nexport function makeDrawEllipseInfo(center: [number, number], radius: [number, number], value: number): DrawCircleInfo {\r\n    return {\r\n        drawShape: DrawShape.Ellipse,\r\n        center,\r\n        radius,\r\n        value\r\n    }\r\n}\r\n\r\nexport type DrawInfo = DrawSquareInfo | DrawCircleInfo","export const updateAlphaBeta = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D material;\r\n    uniform float dt;\r\n    uniform float cellSize;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        // Get material values\r\n        vec3 mat = texture2D(material, uv).rgb;\r\n        float permeability = mat.x;\r\n        float permittivity = mat.y;\r\n        float conductivity = mat.z;\r\n\r\n        // Calculate alpha and beta for electric field\r\n        float cEl = conductivity * dt / (2.0 * permeability);\r\n        float dEl = 1.0 / (1.0 + cEl);\r\n        float alphaEl = (1.0 - cEl) * dEl;\r\n        float betaEl = dt / (permeability * cellSize) * dEl;\r\n\r\n        // Calculate alpha and beta for magnetic field\r\n        float cMag = conductivity * dt / (2.0 * permittivity);\r\n        float dMag = 1.0 / (1.0 + cMag);\r\n        float alphaMag = (1.0 - cMag) * dMag;\r\n        float betaMag = dt / (permittivity * cellSize) * dMag;\r\n\r\n        gl_FragColor = vec4(alphaEl, betaEl, alphaMag, betaMag);\r\n    }\r\n`\r\n\r\nexport const updateElectric = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D electricField;\r\n    uniform sampler2D magneticField;\r\n    uniform sampler2D alphaBetaField;\r\n    uniform vec2 relativeCellSize;\r\n    uniform bool reflectiveBoundary;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        if (!reflectiveBoundary) {\r\n            vec2 b = 2.0 * relativeCellSize;\r\n\r\n            float xAtMinBound = uv.x < b.x ? relativeCellSize.x : 0.0;\r\n            float xAtMaxBound = uv.x + b.x >= 1.0 ? -relativeCellSize.x : 0.0;\r\n            float yAtMinBound = uv.y < b.y ? relativeCellSize.y : 0.0;\r\n            float yAtMaxBound = uv.y + b.y >= 1.0 ? -relativeCellSize.y : 0.0;\r\n\r\n            if (xAtMinBound != 0.0 || xAtMaxBound != 0.0 || yAtMinBound != 0.0 || yAtMaxBound != 0.0) {\r\n                gl_FragColor = texture2D(electricField, vec2(\r\n                    uv.x + xAtMinBound + xAtMaxBound,\r\n                    uv.y + yAtMinBound + yAtMaxBound\r\n                ));\r\n                return;\r\n            }\r\n        }\r\n\r\n        vec2 alphaBeta = texture2D(alphaBetaField, uv).rg;\r\n        \r\n        vec3 el = texture2D(electricField, uv).rgb;\r\n        vec3 mag = texture2D(magneticField, uv).rgb;\r\n        vec3 magXN = texture2D(magneticField, uv - vec2(relativeCellSize.x, 0.0)).rgb;\r\n        vec3 magYN = texture2D(magneticField, uv - vec2(0.0, relativeCellSize.y)).rgb;\r\n\r\n        vec3 newEl = vec3(\r\n            // d_Y Z - d_Z Y, but d_Z = 0 in 2d\r\n            alphaBeta.x * el.x + alphaBeta.y * (mag.z - magYN.z),\r\n\r\n            // d_Z X - d_X Z, but d_Z = 0 in 2d\r\n            alphaBeta.x * el.y + alphaBeta.y * (magXN.z - mag.z),\r\n\r\n            // d_X Y - d_Y X\r\n            alphaBeta.x * el.z + alphaBeta.y * ((mag.y - magXN.y) - (mag.x - magYN.x))\r\n        );\r\n\r\n        gl_FragColor = vec4(newEl, 0.0);\r\n    }\r\n`\r\n\r\nexport const updateMagnetic = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D electricField;\r\n    uniform sampler2D magneticField;\r\n    uniform sampler2D alphaBetaField;\r\n    uniform vec2 relativeCellSize;\r\n    uniform bool reflectiveBoundary;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        if (!reflectiveBoundary) {\r\n            vec2 b = 2.0 * relativeCellSize;\r\n\r\n            float xAtMinBound = uv.x < b.x ? relativeCellSize.x : 0.0;\r\n            float xAtMaxBound = uv.x + b.x >= 1.0 ? -relativeCellSize.x : 0.0;\r\n            float yAtMinBound = uv.y < b.y ? relativeCellSize.y : 0.0;\r\n            float yAtMaxBound = uv.y + b.y >= 1.0 ? -relativeCellSize.y : 0.0;\r\n\r\n            if (xAtMinBound != 0.0 || xAtMaxBound != 0.0 || yAtMinBound != 0.0 || yAtMaxBound != 0.0) {\r\n                gl_FragColor = texture2D(magneticField, vec2(\r\n                    uv.x + xAtMinBound + xAtMaxBound,\r\n                    uv.y + yAtMinBound + yAtMaxBound\r\n                ));\r\n                return;\r\n            }\r\n        }\r\n\r\n        vec2 alphaBeta = texture2D(alphaBetaField, uv).ba;\r\n\r\n        vec3 mag = texture2D(magneticField, uv).rgb;\r\n        vec3 el = texture2D(electricField, uv).rgb;\r\n        vec3 elXP = texture2D(electricField, uv + vec2(relativeCellSize.x, 0.0)).rgb;\r\n        vec3 elYP = texture2D(electricField, uv + vec2(0.0, relativeCellSize.y)).rgb;\r\n\r\n        vec3 newMag = vec3(\r\n            // d_Y Z - d_Z Y, but d_Z = 0 in 2d\r\n            alphaBeta.x * mag.x - alphaBeta.y * (elYP.z - el.z),\r\n\r\n            // d_Z X - d_X Z, but d_Z = 0 in 2d\r\n            alphaBeta.x * mag.y - alphaBeta.y * (el.z - elXP.z),\r\n\r\n            // d_X Y - d_Y X\r\n            alphaBeta.x * mag.z - alphaBeta.y * ((elXP.y - el.y) - (elYP.x - el.x))\r\n        );\r\n\r\n        gl_FragColor = vec4(newMag, 0.0);\r\n    }\r\n`\r\n\r\nexport const injectSource = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D sourceField;\r\n    uniform sampler2D field;\r\n    uniform float dt;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        vec4 source = texture2D(sourceField, uv);\r\n        vec4 field = texture2D(field, uv);\r\n\r\n        gl_FragColor = field + dt * source;\r\n    }\r\n`\r\n\r\nexport const decaySource = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D sourceField;\r\n    uniform float dt;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        vec4 source = texture2D(sourceField, uv);\r\n        vec4 decayedSource = source * pow(0.1, dt);\r\n\r\n        gl_FragColor = decayedSource;\r\n    }\r\n`\r\n\r\nexport const drawSquare = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D texture;\r\n    uniform vec2 pos;\r\n    uniform vec4 value;\r\n    uniform vec2 size;\r\n    uniform vec4 keep;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        vec2 d = abs(pos.xy - uv.xy);\r\n        vec4 oldValue = texture2D(texture, uv);\r\n        bool within = all(lessThanEqual(d, size));\r\n\r\n        gl_FragColor = within ? value + keep * oldValue : oldValue;\r\n    }\r\n`\r\n\r\nexport const drawEllipse = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D texture;\r\n    uniform vec2 pos;\r\n    uniform vec4 value;\r\n    uniform vec2 radius;\r\n    uniform vec4 keep;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        // Calculate distance squared\r\n        vec2 d = pos.xy - uv.xy;\r\n\r\n        // Check if distance is within ellipse\r\n        d = d / radius;\r\n        d = d * d;\r\n\r\n        bool within = d.x + d.y <= 1.0;\r\n        \r\n        vec4 oldValue = texture2D(texture, uv);\r\n\r\n        gl_FragColor = within ? value + keep * oldValue : oldValue;\r\n    }\r\n`\r\n\r\nexport const vert = `\r\n    precision highp float;\r\n    attribute vec2 position;\r\n    varying vec2 uv;\r\n    void main() {\r\n        uv = 0.5 * (position + 1.0);\r\n        gl_Position = vec4(position, 0, 1);\r\n    }\r\n`\r\n\r\nexport const copyUint8ToFloat16 = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D texture;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        gl_FragColor = (-128.0 + 255.0 * texture2D(texture, uv)) / 4.0;\r\n    }\r\n`\r\n\r\nexport const copyFloat16ToUint8 = `\r\n    precision highp float;\r\n\r\n    uniform sampler2D texture;\r\n\r\n    varying vec2 uv;\r\n\r\n    void main() {\r\n        gl_FragColor = (128.0 + 4.0 * texture2D(texture, uv)) / 256.0;\r\n    }\r\n`","import { Regl, Framebuffer2D, DrawCommand } from \"regl\"\r\nimport * as k from \"./kernels/simulation\"\r\nimport { DrawInfo, DrawShape } from \"./drawing\"\r\n\r\nexport type MaterialType = \"permittivity\" | \"permeability\" | \"conductivity\"\r\n\r\nfunction clamp(min: number, max: number, value: number) {\r\n    return Math.max(min, Math.min(max, value))\r\n}\r\n\r\nfunction snapToGrid(relativePoint: [number, number], gridSize: [number, number]) {\r\n    const relativeCellSize = [1 / gridSize[0], 1 / gridSize[1]]\r\n    const residual = [relativePoint[0] % relativeCellSize[0], relativePoint[1] % relativeCellSize[1]]\r\n    const gridPoint = [\r\n        relativePoint[0] - residual[0] + 0.5 * relativeCellSize[0],\r\n        relativePoint[1] - residual[1] + 0.5 * relativeCellSize[1]\r\n    ]\r\n\r\n    return gridPoint\r\n}\r\n\r\nexport function combineMaterialMaps(permittivity: number[][],\r\n    permeability: number[][], conductivity: number[][]): number[][][] {\r\n    const material: number[][][] = [];\r\n    const width = permittivity[0].length;\r\n    const height = permittivity.length;\r\n\r\n    // TODO: Verify same dims\r\n\r\n    for (let y = 0; y < height; y++) {\r\n        const row: number[][] = []\r\n\r\n        for (let x = 0; x < width; x++) {\r\n            row.push([\r\n                clamp(0, 255, 128 + 4 * permittivity[y][x]),\r\n                clamp(0, 255, 128 + 4 * permeability[y][x]),\r\n                clamp(0, 255, 128 + 4 * conductivity[y][x]),\r\n            ])\r\n        }\r\n\r\n        material.push(row)\r\n    }\r\n\r\n    return material\r\n}\r\n\r\nclass DoubleFramebuffer2D {\r\n    current: Framebuffer2D\r\n    previous: Framebuffer2D\r\n\r\n    constructor(current: Framebuffer2D, previous: Framebuffer2D) {\r\n        this.current = current\r\n        this.previous = previous\r\n    }\r\n\r\n    swap() {\r\n        const oldCurrent = this.current\r\n        this.current = this.previous\r\n        this.previous = oldCurrent\r\n    }\r\n}\r\n\r\nexport type SimulationData = {\r\n    time: number\r\n    electricField: DoubleFramebuffer2D\r\n    magneticField: DoubleFramebuffer2D\r\n    material: DoubleFramebuffer2D\r\n    alphaBetaField: Framebuffer2D\r\n    electricSourceField: DoubleFramebuffer2D\r\n}\r\n\r\n/**\r\n * Simulates the electromagnetic field with materials.\r\n */\r\nexport interface Simulator {\r\n    /**\r\n     * Performs the update step for the electric field.\r\n     * @param dt Time step size\r\n     */\r\n    stepElectric: (dt: number) => void\r\n\r\n    /**\r\n     * Performs the update step for the magnetic field.\r\n     * @param dt Time step size\r\n     */\r\n    stepMagnetic: (dt: number) => void\r\n\r\n    /**\r\n     * Resets the electric, magnetic and source fields\r\n     * and sets the time back to `0`.\r\n     */\r\n    resetFields: () => void\r\n\r\n    /**\r\n     * Resets the materials to their default values of\r\n     * `1` for permittivity and permeability and `0` for\r\n     * conductivity.\r\n     */\r\n    resetMaterials: () => void\r\n\r\n    /**\r\n     * Injects a value into the electric source field.\r\n     * @param drawInfo Draw info that specifies where and\r\n     * what values to inject.\r\n     * @param dt Time step size\r\n     */\r\n    injectSignal: (drawInfo: DrawInfo, dt: number) => void\r\n\r\n    /**\r\n     * Returns the simulation data containing the frame-buffers\r\n     * for the fields and materials.\r\n     */\r\n    getData: () => SimulationData\r\n\r\n    /**\r\n     * Returns the size of a cell.\r\n     */\r\n    getCellSize: () => number\r\n\r\n    /**\r\n     * Sets the size of a cell.\r\n     * @param cellSize Size of a cell\r\n     */\r\n    setCellSize: (cellSize: number) => void\r\n\r\n    /**\r\n     * Returns the width and height of the grid in\r\n     * number of cells.\r\n     */\r\n    getGridSize: () => [number, number]\r\n\r\n    /**\r\n     * Sets the width and height of the grid in\r\n     * number of cells.\r\n     * @param reflectiveBoundary Width and height of the grid in\r\n     * number of cells.\r\n     */\r\n    setGridSize: (gridSize: [number, number]) => void\r\n\r\n    /**\r\n     * Returns whether the grid boundary is reflective.\r\n     */\r\n    getReflectiveBoundary: () => boolean\r\n\r\n    /**\r\n     * Sets whether the grid boundary is reflective.\r\n     * @param reflectiveBoundary Whether the grid boundary is reflective\r\n     */\r\n    setReflectiveBoundary: (reflectiveBoundary: boolean) => void\r\n\r\n    /**\r\n     * Draws values onto a material.\r\n     * @param materialType Material to draw onto\r\n     * @param drawInfo Draw info that specifies where and\r\n     * what values to draw.\r\n     */\r\n    drawMaterial: (materialType: MaterialType, drawInfo: DrawInfo) => void\r\n\r\n    /**\r\n     * Loads a material from a 3D array.\r\n     * @param material Material of shape `[height, width, 3]`.\r\n     * \r\n     * Channel 0: Permittivity\r\n     * \r\n     * Channel 1: Permeability\r\n     * \r\n     * Channel 2: Conductivity\r\n     */\r\n    loadMaterial: (material: number[][][]) => void\r\n\r\n    /**\r\n     * Loads a material from arrays.\r\n     * @param permittivity Array of shape `[height, width]`\r\n     * specifying the permittivity at every cell.\r\n     * @param permeability Array of shape `[height, width]`\r\n     * specifying the permeability at every cell.\r\n     * @param conductivity Array of shape `[height, width]`\r\n     * specifying the conductivity at every cell.\r\n     */\r\n    loadMaterialFromComponents: (permittivity: number[][], permeability: number[][], conductivity: number[][]) => void\r\n\r\n    /**\r\n     * Returns the material as a 3D array.\r\n     * @param material Material of shape `[height, width, 3]`.\r\n     * \r\n     * Channel 0: Permittivity\r\n     * \r\n     * Channel 1: Permeability\r\n     * \r\n     * Channel 2: Conductivity\r\n     */\r\n    getMaterial: () => number[][][]\r\n}\r\n\r\nexport class FDTDSimulator implements Simulator {\r\n    private data: SimulationData\r\n\r\n    private updateMagnetic: DrawCommand\r\n    private updateElectric: DrawCommand\r\n    private updateAlphaBeta: DrawCommand\r\n\r\n    private injectSource: DrawCommand\r\n    private decaySource: DrawCommand\r\n\r\n    private drawOnTexture: { [shape: string]: DrawCommand }\r\n\r\n    private copyUint8ToFloat16: DrawCommand\r\n    private copyFloat16ToUint8: DrawCommand\r\n\r\n    private frameBuffers: Framebuffer2D[]\r\n    private alphaBetaDt: number // dt that the alpha beta values were calculated for\r\n\r\n    constructor(readonly regl: Regl, private gridSize: [number, number], private cellSize: number, public reflectiveBoundary: boolean, private dt: number) {\r\n        this.alphaBetaDt = dt\r\n\r\n        this.frameBuffers = []\r\n\r\n        const makeFrameBuffer = () => {\r\n            // Create half-precision texture at grid size\r\n            const fbo = regl.framebuffer({\r\n                color: regl.texture({\r\n                    width: gridSize[0],\r\n                    height: gridSize[1],\r\n                    wrap: \"clamp\",\r\n                    type: \"float16\",\r\n                    format: \"rgba\",\r\n                    min: \"nearest\",\r\n                    mag: \"nearest\",\r\n                }),\r\n                depthStencil: false\r\n            })\r\n\r\n            // Keep track of all fbos so we can resize them\r\n            // together if the grid size changes.\r\n            this.frameBuffers.push(fbo)\r\n\r\n            return fbo\r\n        }\r\n\r\n        const makeField = () => {\r\n            return new DoubleFramebuffer2D(\r\n                makeFrameBuffer(),\r\n                makeFrameBuffer()\r\n            )\r\n        }\r\n\r\n        this.data = {\r\n            time: 0,\r\n            electricField: makeField(),\r\n            magneticField: makeField(),\r\n            electricSourceField: makeField(),\r\n            material: makeField(),\r\n            alphaBetaField: makeFrameBuffer()\r\n        }\r\n\r\n        const makeFragFn = <T>(frag: string, fbos: { current: Framebuffer2D }, uniforms: T) => {\r\n            return regl({\r\n                frag: frag,\r\n                framebuffer: () => fbos.current,\r\n                uniforms: uniforms,\r\n\r\n                attributes: {\r\n                    position: [\r\n                        [1, -1],\r\n                        [1, 1],\r\n                        [-1, -1],\r\n                        [-1, 1]\r\n                    ]\r\n                },\r\n                vert: k.vert,\r\n                count: 4,\r\n                primitive: \"triangle strip\",\r\n                depth: { enable: false }\r\n            })\r\n        }\r\n\r\n        const makeFragWithFboPropFn = (frag: string, uniforms: any) => {\r\n            return regl({\r\n                frag: frag,\r\n                framebuffer: (_: any, prop: any) => prop.fbo,\r\n                uniforms: uniforms,\r\n\r\n                attributes: {\r\n                    position: [\r\n                        [1, -1],\r\n                        [1, 1],\r\n                        [-1, -1],\r\n                        [-1, 1]\r\n                    ]\r\n                },\r\n                vert: k.vert,\r\n                count: 4,\r\n                primitive: \"triangle strip\",\r\n                depth: { enable: false }\r\n            })\r\n        }\r\n\r\n        this.updateAlphaBeta = makeFragFn(k.updateAlphaBeta, { current: this.data.alphaBetaField }, {\r\n            dt: (_: any, props: any) => props.dt,\r\n            cellSize: (_: any, props: any) => props.cellSize,\r\n            material: (_: any, props: any) => props.material,\r\n        })\r\n\r\n        this.updateElectric = makeFragFn(k.updateElectric, this.data.electricField, {\r\n            electricField: (_: any, props: any) => props.electricField,\r\n            magneticField: (_: any, props: any) => props.magneticField,\r\n            alphaBetaField: (_: any, props: any) => props.alphaBetaField,\r\n            relativeCellSize: (_: any, props: any) => props.relativeCellSize,\r\n            reflectiveBoundary: (_: any, props: any) => props.reflectiveBoundary,\r\n        })\r\n\r\n        this.updateMagnetic = makeFragFn(k.updateMagnetic, this.data.magneticField, {\r\n            electricField: (_: any, props: any) => props.electricField,\r\n            magneticField: (_: any, props: any) => props.magneticField,\r\n            alphaBetaField: (_: any, props: any) => props.alphaBetaField,\r\n            relativeCellSize: (_: any, props: any) => props.relativeCellSize,\r\n            reflectiveBoundary: (_: any, props: any) => props.reflectiveBoundary,\r\n        })\r\n\r\n        this.injectSource = makeFragFn(k.injectSource, this.data.electricField, {\r\n            sourceField: (_: any, props: any) => props.sourceField,\r\n            field: (_: any, props: any) => props.field,\r\n            dt: (_: any, props: any) => props.dt,\r\n        })\r\n\r\n        this.decaySource = makeFragFn(k.decaySource, this.data.electricSourceField, {\r\n            sourceField: (_: any, props: any) => props.sourceField,\r\n            dt: (_: any, props: any) => props.dt,\r\n        })\r\n\r\n        this.drawOnTexture = {\r\n            [DrawShape.Ellipse]: makeFragWithFboPropFn(k.drawEllipse, {\r\n                texture: (_: any, props: any) => props.texture,\r\n                pos: (_: any, props: any) => props.pos,\r\n                value: (_: any, props: any) => props.value,\r\n                radius: (_: any, props: any) => props.radius,\r\n                keep: (_: any, props: any) => props.keep,\r\n            }),\r\n            [DrawShape.Square]: makeFragWithFboPropFn(k.drawSquare, {\r\n                texture: (_: any, props: any) => props.texture,\r\n                pos: (_: any, props: any) => props.pos,\r\n                value: (_: any, props: any) => props.value,\r\n                size: (_: any, props: any) => props.size,\r\n                keep: (_: any, props: any) => props.keep,\r\n            }),\r\n        }\r\n\r\n        this.copyUint8ToFloat16 = makeFragFn(k.copyUint8ToFloat16, this.data.material, {\r\n            texture: (_: any, props: any) => props.texture\r\n        })\r\n\r\n        this.copyFloat16ToUint8 = makeFragWithFboPropFn(k.copyFloat16ToUint8, {\r\n            texture: (_: any, props: any) => props.texture\r\n        })\r\n\r\n        this.resetFields()\r\n        this.resetMaterials()\r\n    }\r\n\r\n    updateAlphaBetaFromMaterial(dt: number) {\r\n        this.alphaBetaDt = dt\r\n        this.updateAlphaBeta({\r\n            material: this.data.material.current,\r\n            dt: dt,\r\n            cellSize: this.cellSize\r\n        })\r\n    }\r\n\r\n    getGridSize = () => this.gridSize;\r\n    setGridSize = (gridSize: [number, number]) => {\r\n        this.gridSize = gridSize\r\n\r\n        this.frameBuffers.forEach(frameBuffer => frameBuffer.resize(gridSize[0], gridSize[1]))\r\n\r\n        // TODO: Copy old data ?\r\n\r\n        this.resetFields()\r\n    }\r\n\r\n    getCellSize = () => this.cellSize;\r\n    setCellSize = (cellSize: number) => {\r\n        this.cellSize = cellSize\r\n\r\n        this.resetFields()\r\n    }\r\n\r\n    getReflectiveBoundary = () => this.reflectiveBoundary;\r\n    setReflectiveBoundary = (reflectiveBoundary: boolean) => {\r\n        this.reflectiveBoundary = reflectiveBoundary\r\n    }\r\n\r\n    stepElectric = (dt: number) => {\r\n        if (this.alphaBetaDt !== dt) {\r\n            this.updateAlphaBetaFromMaterial(dt)\r\n        }\r\n\r\n        this.data.electricField.swap()\r\n        this.data.electricSourceField.swap()\r\n\r\n        // Writes to E current\r\n        this.injectSource({\r\n            sourceField: this.data.electricSourceField.previous,\r\n            field: this.data.electricField.previous,\r\n            dt: dt\r\n        })\r\n\r\n        this.data.electricField.swap()\r\n\r\n        // Writes to S current\r\n        this.decaySource({\r\n            sourceField: this.data.electricSourceField.previous,\r\n            dt: dt\r\n        })\r\n\r\n        // Writes to E current\r\n        this.updateElectric({\r\n            electricField: this.data.electricField.previous,\r\n            magneticField: this.data.magneticField.current,\r\n            alphaBetaField: this.data.alphaBetaField,\r\n            relativeCellSize: [1 / this.gridSize[0], 1 / this.gridSize[1]],\r\n            reflectiveBoundary: this.reflectiveBoundary,\r\n        })\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    stepMagnetic = (dt: number) => {\r\n        if (this.alphaBetaDt !== dt) {\r\n            this.updateAlphaBetaFromMaterial(dt)\r\n        }\r\n\r\n        this.data.magneticField.swap()\r\n\r\n        this.updateMagnetic({\r\n            electricField: this.data.electricField.current,\r\n            magneticField: this.data.magneticField.previous,\r\n            alphaBetaField: this.data.alphaBetaField,\r\n            relativeCellSize: [1 / this.gridSize[0], 1 / this.gridSize[1]],\r\n            reflectiveBoundary: this.reflectiveBoundary,\r\n        })\r\n\r\n        this.data.time += dt / 2\r\n    }\r\n\r\n    resetFields = () => {\r\n        this.data.time = 0\r\n\r\n        this.regl.clear({\r\n            color: [0, 0, 0, 0],\r\n            framebuffer: this.data.electricField.current\r\n        })\r\n\r\n        this.regl.clear({\r\n            color: [0, 0, 0, 0],\r\n            framebuffer: this.data.magneticField.current\r\n        })\r\n\r\n        this.regl.clear({\r\n            color: [0, 0, 0, 0],\r\n            framebuffer: this.data.electricSourceField.current\r\n        })\r\n    }\r\n\r\n    resetMaterials = () => {\r\n        this.regl.clear({\r\n            color: [1, 1, 0, 0],\r\n            framebuffer: this.data.material.current\r\n        })\r\n\r\n        this.updateAlphaBetaFromMaterial(this.alphaBetaDt)\r\n    }\r\n\r\n    drawMaterial = (materialType: MaterialType, drawInfo: DrawInfo) => {\r\n        this.data.material.swap()\r\n\r\n        const value = [0, 0, 0, 0]\r\n        const keep = [1, 1, 1, 1]\r\n        if (materialType === \"permittivity\") {\r\n            value[0] = drawInfo.value\r\n            keep[0] = 0\r\n        } else if (materialType === \"permeability\") {\r\n            value[1] = drawInfo.value\r\n            keep[1] = 0\r\n        } else if (materialType === \"conductivity\") {\r\n            value[2] = drawInfo.value\r\n            keep[2] = 0\r\n        }\r\n\r\n        const uniforms: any = {\r\n            pos: snapToGrid(drawInfo.center, this.gridSize),\r\n            value: value,\r\n            keep: keep,\r\n            texture: this.data.material.previous,\r\n            fbo: this.data.material.current\r\n        }\r\n\r\n        if (drawInfo.drawShape === DrawShape.Ellipse) {\r\n            uniforms.radius = drawInfo.radius\r\n        } else if (drawInfo.drawShape === DrawShape.Square) {\r\n            uniforms.size = drawInfo.halfSize\r\n        }\r\n\r\n        this.drawOnTexture[drawInfo.drawShape](uniforms)\r\n\r\n        this.updateAlphaBetaFromMaterial(this.alphaBetaDt)\r\n    }\r\n\r\n    injectSignal = (drawInfo: DrawInfo, dt: number) => {\r\n        this.data.electricSourceField.swap()\r\n\r\n        const uniforms: any = {\r\n            pos: snapToGrid(drawInfo.center, this.gridSize),\r\n            value: [0, 0, drawInfo.value * dt, 0],\r\n            keep: [1, 1, 1, 1],\r\n            texture: this.data.electricSourceField.previous,\r\n            fbo: this.data.electricSourceField.current\r\n        }\r\n\r\n        if (drawInfo.drawShape === DrawShape.Ellipse) {\r\n            uniforms.radius = drawInfo.radius\r\n        } else if (drawInfo.drawShape === DrawShape.Square) {\r\n            uniforms.size = drawInfo.halfSize\r\n        }\r\n\r\n        this.drawOnTexture[drawInfo.drawShape](uniforms)\r\n    }\r\n\r\n    loadMaterial = (material: number[][][]) => {\r\n        const materialTexture = this.regl.texture({\r\n            data: material,\r\n            format: \"rgb\",\r\n            type: \"uint8\",\r\n            min: \"nearest\",\r\n            mag: \"nearest\",\r\n        })\r\n\r\n        this.copyUint8ToFloat16({\r\n            texture: materialTexture\r\n        })\r\n\r\n        materialTexture.destroy()\r\n\r\n        this.updateAlphaBetaFromMaterial(this.alphaBetaDt)\r\n    }\r\n\r\n    loadMaterialFromComponents = (permittivity: number[][], permeability: number[][], conductivity: number[][]) => {\r\n        this.loadMaterial(\r\n            combineMaterialMaps(permittivity, permeability, conductivity)\r\n        )\r\n    }\r\n\r\n    getData = () => this.data\r\n\r\n    getMaterial = () => {\r\n        const fbo = this.regl.framebuffer({\r\n            color: this.regl.texture({\r\n                width: this.gridSize[0],\r\n                height: this.gridSize[1],\r\n                wrap: \"clamp\",\r\n                type: \"uint8\",\r\n                format: \"rgba\",\r\n                min: \"nearest\",\r\n                mag: \"nearest\",\r\n            }),\r\n            depthStencil: false\r\n        })\r\n\r\n        this.copyFloat16ToUint8({\r\n            fbo: fbo,\r\n            texture: this.data.material.current\r\n        })\r\n\r\n        const materialData = this.regl.read({\r\n            framebuffer: fbo\r\n        })\r\n\r\n        fbo.destroy()\r\n\r\n        // Uint8 to float with correct scaling\r\n        const materialFloats: number[][][] = []\r\n        for (let y = 0; y < this.gridSize[1]; y++) {\r\n            const row: number[][] = []\r\n            for (let x = 0; x < this.gridSize[0]; x++) {\r\n                row.push([\r\n                    (materialData[y * this.gridSize[0] * 4 + x * 4 + 0] - 127) / 4,\r\n                    (materialData[y * this.gridSize[0] * 4 + x * 4 + 1] - 127) / 4,\r\n                    (materialData[y * this.gridSize[0] * 4 + x * 4 + 2] - 127) / 4,\r\n                    // +3 is unused\r\n                ])\r\n            }\r\n            materialFloats.push(row)\r\n        }\r\n\r\n        return materialFloats\r\n    }\r\n}\r\n","import { createReglFromCanvas, makeRenderSimulatorCanvas } from \"./rendering\"\r\nimport { FDTDSimulator, MaterialType, Simulator } from \"./simulator\"\r\nimport { SignalSource } from \"./sources\"\r\nimport { DrawInfo } from \"./drawing\"\r\n\r\nexport type EMState = {\r\n    renderToCanvas: (showElectric: boolean, showMagnetic: boolean) => void\r\n    adjustCanvasSize: (canvasSize: [number, number]) => void\r\n    stepSim: (dt: number) => void\r\n\r\n    injectSignal: (drawInfo: DrawInfo, dt: number) => void\r\n\r\n    getSources: () => SignalSource[]\r\n    setSources: (newSources: SignalSource[]) => void\r\n\r\n    setGridSize: (newGridSize: [number, number]) => void\r\n    setCellSize: (newCellSize: number) => void\r\n    setReflectiveBoundary: (reflectiveBoundary: boolean) => void\r\n\r\n    getTime: () => number\r\n\r\n    loadMaterialFromComponents: (permittivity: number[][], permeability: number[][], conductivity: number[][]) => void\r\n    resetFields: () => void\r\n    resetMaterials: () => void\r\n\r\n    drawMaterial: (materialType: MaterialType, drawInfo: DrawInfo) => void\r\n    getMaterial: () => number[][][]\r\n}\r\n\r\nexport function createEM(canvas: HTMLCanvasElement, gridSize: [number, number],\r\n    cellSize: number, reflectiveBoundary: boolean, dt: number): EMState {\r\n    const regl = createReglFromCanvas(canvas)\r\n\r\n    const { render, adjustCanvasSize, adjustGridSize } = makeRenderSimulatorCanvas(regl, [canvas.width, canvas.height], gridSize)\r\n    const sim: Simulator = new FDTDSimulator(regl, gridSize, cellSize, reflectiveBoundary, dt)\r\n\r\n    const renderToCanvas = (showElectric: boolean, showMagnetic: boolean) => {\r\n        const simData = sim.getData()\r\n\r\n        render(simData.electricField.current, simData.magneticField.current,\r\n            simData.material.current, sim.getCellSize(), sim.getGridSize(),\r\n            showElectric, showMagnetic)\r\n    }\r\n\r\n    let sources: SignalSource[] = []\r\n\r\n    const stepSim = (dt: number) => {\r\n        for (const source of sources) {\r\n            source.inject(sim, dt)\r\n        }\r\n\r\n        sim.stepMagnetic(dt)\r\n        sim.stepElectric(dt)\r\n    }\r\n\r\n    const setGridSize = (newGridSize: [number, number]) => {\r\n        sim.setGridSize(newGridSize)\r\n        adjustGridSize(newGridSize)\r\n    }\r\n\r\n    return {\r\n        renderToCanvas: renderToCanvas,\r\n        adjustCanvasSize: adjustCanvasSize,\r\n        stepSim: stepSim,\r\n        injectSignal: sim.injectSignal,\r\n        getSources: () => sources,\r\n        setSources: (newSources: SignalSource[]) => sources = newSources,\r\n        setGridSize: setGridSize,\r\n        setCellSize: sim.setCellSize,\r\n        getTime: () => sim.getData().time,\r\n        setReflectiveBoundary: sim.setReflectiveBoundary,\r\n        loadMaterialFromComponents: sim.loadMaterialFromComponents,\r\n        resetFields: sim.resetFields,\r\n        resetMaterials: sim.resetMaterials,\r\n        drawMaterial: sim.drawMaterial,\r\n        getMaterial: sim.getMaterial\r\n    }\r\n}","import * as k from \"./kernels/rendering\"\r\nimport REGL, { Regl, Framebuffer2D } from 'regl'\r\n\r\nexport function createReglFromCanvas(canvas: HTMLCanvasElement) {\r\n    return REGL({\r\n        canvas: canvas,\r\n        extensions: [\r\n            \"OES_texture_half_float\",\r\n        ],\r\n        optionalExtensions: [\r\n            \"OES_texture_half_float_linear\",\r\n            // Shows a warning without this. However making it\r\n            // non-optional would make it crash on iPad 6 even\r\n            // though it works.\r\n            \"EXT_color_buffer_half_float\"\r\n        ]\r\n    })\r\n}\r\n\r\nexport function makeRenderSimulatorCanvas(regl: Regl, canvasSize: [number, number], gridSize: [number, number]) {\r\n    const filter = regl.hasExtension(\"OES_texture_half_float_linear\") ? \"linear\" : \"nearest\"\r\n\r\n    const frameBuffers: Framebuffer2D[] = []\r\n\r\n    const makeFrameBuffer = () => {\r\n        // Create half-precision texture at canvas size\r\n        const fbo = regl.framebuffer({\r\n            color: regl.texture({\r\n                width: canvasSize[0],\r\n                height: canvasSize[1],\r\n                wrap: \"clamp\",\r\n                type: \"float16\",\r\n                format: \"rgba\",\r\n                min: filter,\r\n                mag: filter\r\n            }),\r\n            depthStencil: false\r\n        })\r\n\r\n        // Keep track of all frame buffers so we can\r\n        // resize them when the canvas size changes.\r\n        frameBuffers.push(fbo)\r\n\r\n        return fbo\r\n    }\r\n\r\n    const fbos = [makeFrameBuffer(), makeFrameBuffer()]\r\n    const energyFbo = makeFrameBuffer()\r\n    const backgroundFbo = makeFrameBuffer()\r\n\r\n    type RenderBackgroundUniforms = {\r\n        gridSize: [number, number]\r\n    }\r\n\r\n    const renderBackground = regl<RenderBackgroundUniforms, {}, RenderBackgroundUniforms>({\r\n        frag: k.renderBackground,\r\n        framebuffer: backgroundFbo,\r\n        uniforms: {\r\n            gridSize: (_, { gridSize }) => gridSize\r\n        },\r\n\r\n        attributes: {\r\n            position: [\r\n                [1, -1],\r\n                [1, 1],\r\n                [-1, -1],\r\n                [-1, 1]\r\n            ]\r\n        },\r\n        vert: k.vertDraw,\r\n        count: 4,\r\n        primitive: \"triangle strip\",\r\n        depth: { enable: false }\r\n    })\r\n\r\n    type RenderEnergyUniforms = {\r\n        brightness: number\r\n        electricField: Framebuffer2D\r\n        magneticField: Framebuffer2D\r\n        material: Framebuffer2D\r\n        electricEnergyFactor: number\r\n        magneticEnergyFactor: number\r\n    }\r\n\r\n    type RenderEnergyAttributes = {\r\n        position: number[][]\r\n    }\r\n\r\n    const renderEnergy = regl<RenderEnergyUniforms, RenderEnergyAttributes, RenderEnergyUniforms>({\r\n        frag: k.renderEnergy,\r\n        framebuffer: energyFbo,\r\n        uniforms: {\r\n            brightness: (_, { brightness }) => brightness,\r\n            electricField: (_, { electricField }) => electricField,\r\n            magneticField: (_, { magneticField }) => magneticField,\r\n            material: (_, { material }) => material,\r\n            electricEnergyFactor: (_, { electricEnergyFactor }) => electricEnergyFactor,\r\n            magneticEnergyFactor: (_, { magneticEnergyFactor }) => magneticEnergyFactor,\r\n        },\r\n\r\n        attributes: {\r\n            position: [\r\n                [1, -1],\r\n                [1, 1],\r\n                [-1, -1],\r\n                [-1, 1]\r\n            ]\r\n        },\r\n        vert: k.vertDraw,\r\n        count: 4,\r\n        primitive: \"triangle strip\",\r\n        depth: { enable: false }\r\n    })\r\n\r\n    type BloomExtractUniforms = {\r\n        texture: Framebuffer2D\r\n        threshold: number\r\n    }\r\n\r\n    const bloomExtract = regl<BloomExtractUniforms, {}, BloomExtractUniforms>({\r\n        frag: k.bloomExtract,\r\n        framebuffer: fbos[0],\r\n        uniforms: {\r\n            texture: () => energyFbo,\r\n            threshold: (_, { threshold }) => threshold,\r\n        },\r\n\r\n        attributes: {\r\n            position: [\r\n                [1, -1],\r\n                [1, 1],\r\n                [-1, -1],\r\n                [-1, 1]\r\n            ]\r\n        },\r\n        vert: k.vertDraw,\r\n        count: 4,\r\n        primitive: \"triangle strip\",\r\n        depth: { enable: false }\r\n    })\r\n\r\n    const blurVert = regl<{ texture: Framebuffer2D, direction: [number, number] }, {}, { texture: Framebuffer2D }>({\r\n        frag: k.blurDirectional,\r\n        framebuffer: fbos[1],\r\n        uniforms: {\r\n            texture: (_, { texture }) => texture,\r\n            direction: ctx => [1 / ctx.drawingBufferHeight, 0]\r\n        },\r\n\r\n        attributes: {\r\n            position: [\r\n                [1, -1],\r\n                [1, 1],\r\n                [-1, -1],\r\n                [-1, 1]\r\n            ]\r\n        },\r\n        vert: k.vertDraw,\r\n        count: 4,\r\n        primitive: \"triangle strip\",\r\n        depth: { enable: false }\r\n    })\r\n\r\n    const blurHor = regl({\r\n        frag: k.blurDirectional,\r\n        framebuffer: fbos[0],\r\n        uniforms: {\r\n            texture: fbos[1],\r\n            direction: ctx => [0, 1 / ctx.drawingBufferHeight]\r\n        },\r\n\r\n        attributes: {\r\n            position: [\r\n                [1, -1],\r\n                [1, 1],\r\n                [-1, -1],\r\n                [-1, 1]\r\n            ]\r\n        },\r\n        vert: k.vertDraw,\r\n        count: 4,\r\n        primitive: \"triangle strip\",\r\n        depth: { enable: false }\r\n    })\r\n\r\n    type DrawUniforms = {\r\n        energyTexture: Framebuffer2D\r\n        bloomTexture: Framebuffer2D\r\n        materialTexture: Framebuffer2D\r\n        backgroundTexture: Framebuffer2D\r\n    }\r\n\r\n    const draw = regl<DrawUniforms, {}, DrawUniforms>({\r\n        frag: k.draw,\r\n        uniforms: {\r\n            energyTexture: (_, { energyTexture }) => energyTexture,\r\n            bloomTexture: (_, { bloomTexture }) => bloomTexture,\r\n            materialTexture: (_, { materialTexture }) => materialTexture,\r\n            backgroundTexture: (_, { backgroundTexture }) => backgroundTexture,\r\n        },\r\n\r\n        attributes: {\r\n            position: [\r\n                [1, -1],\r\n                [1, 1],\r\n                [-1, -1],\r\n                [-1, 1]\r\n            ]\r\n        },\r\n        vert: k.vertDraw,\r\n        count: 4,\r\n        primitive: \"triangle strip\",\r\n        depth: { enable: false }\r\n    })\r\n\r\n    function render(electricField: Framebuffer2D, magneticField: Framebuffer2D,\r\n        material: Framebuffer2D, cellSize: number, gridSize: [number, number],\r\n        showElectric: boolean, showMagnetic: boolean) {\r\n        renderEnergy({\r\n            brightness: 0.02 * 0.02 / (cellSize * cellSize),\r\n            electricField: electricField,\r\n            magneticField: magneticField,\r\n            material: material,\r\n            electricEnergyFactor: showElectric ? 1 : 0,\r\n            magneticEnergyFactor: showMagnetic ? 1 : 0\r\n        })\r\n\r\n        bloomExtract({\r\n            threshold: 1\r\n        })\r\n\r\n        const blurCount = 3\r\n        for (let i = 0; i < blurCount; i++) {\r\n            blurVert({\r\n                texture: i === 0 ? energyFbo : fbos[0]\r\n            })\r\n            blurHor()\r\n        }\r\n\r\n        draw({\r\n            energyTexture: energyFbo,\r\n            bloomTexture: fbos[0],\r\n            materialTexture: material,\r\n            backgroundTexture: backgroundFbo\r\n        })\r\n    }\r\n\r\n    renderBackground({\r\n        gridSize: gridSize\r\n    })\r\n\r\n    return {\r\n        render: render,\r\n        adjustCanvasSize: (size: [number, number]) => {\r\n            frameBuffers.forEach(fbo => fbo.resize(size[0], size[1]))\r\n            regl.poll()\r\n        },\r\n        adjustGridSize: (gridSize: [number, number]) => {\r\n            renderBackground({\r\n                gridSize: gridSize\r\n            })\r\n        }\r\n    }\r\n}","import { Simulator } from \"./simulator\"\r\nimport { makeDrawSquareInfo } from \"./drawing\"\r\n\r\nexport interface SignalSource {\r\n    inject(simulator: Simulator, dt: number): void\r\n}\r\n\r\nexport class PointSignalSource implements SignalSource {\r\n    constructor(public amplitude: number, public frequency: number, public position: [number, number], public turnOffTime?: number) {\r\n\r\n    }\r\n\r\n    inject = (simulator: Simulator, dt: number) => {\r\n        const t = simulator.getData().time\r\n        if (t >= 0 && (this.turnOffTime === undefined || t <= this.turnOffTime)) {\r\n            const gridSize = simulator.getGridSize()\r\n            const amplitude = -this.amplitude * Math.cos(2 * Math.PI * this.frequency * t)\r\n            const drawInfo = makeDrawSquareInfo(this.position, [0.5 / gridSize[0], 0.5 / gridSize[1]], amplitude)\r\n            simulator.injectSignal(drawInfo, dt)\r\n        }\r\n    }\r\n}\r\n","import pako from \"pako\"\r\nimport { SignalSource, PointSignalSource } from \"./sources\"\r\n\r\nexport const currentSimulatorMapVersion = 1\r\n\r\nexport type SimulationSettings = {\r\n    dt: number\r\n    gridSize: [number, number]\r\n    simulationSpeed: number\r\n    cellSize: number\r\n}\r\n\r\nexport type MaterialMap = {\r\n    permittivity: number[][]\r\n    permeability: number[][]\r\n    conductivity: number[][]\r\n    shape: [number, number]\r\n}\r\n\r\nexport function makeMaterialMap(material: number[][][]): MaterialMap {\r\n    const permittivity: number[][] = []\r\n    const permeability: number[][] = []\r\n    const conductivity: number[][] = []\r\n\r\n    const shape: [number, number] = [material[0].length, material.length]\r\n    for (let y = 0; y < shape[1]; y++) {\r\n        permittivity.push([])\r\n        permeability.push([])\r\n        conductivity.push([])\r\n        for (let x = 0; x < shape[0]; x++) {\r\n            permittivity[y].push(material[y][x][0])\r\n            permeability[y].push(material[y][x][1])\r\n            conductivity[y].push(material[y][x][2])\r\n        }\r\n    }\r\n\r\n    return {\r\n        permittivity,\r\n        permeability,\r\n        conductivity,\r\n        shape\r\n    }\r\n}\r\n\r\nexport type EncodedMaterialMap = string\r\n\r\nexport type SourceDescriptor = {\r\n    type: \"point\"\r\n    position: [number, number]\r\n    amplitude: number\r\n    frequency: number\r\n    turnOffTime?: number\r\n}\r\n\r\nexport type SimulatorMap = {\r\n    materialMap: MaterialMap\r\n    simulationSettings: SimulationSettings\r\n    sourceDescriptors: SourceDescriptor[]\r\n}\r\n\r\nexport type EncodedSimulatorMap = {\r\n    encodedMaterialMap: string\r\n    simulationSettings: SimulationSettings\r\n    sourceDescriptors: SourceDescriptor[]\r\n    version?: number\r\n}\r\n\r\nexport function signalSourceToDescriptor(source: SignalSource): SourceDescriptor {\r\n    if (source instanceof PointSignalSource) {\r\n        return {\r\n            type: \"point\",\r\n            position: source.position,\r\n            amplitude: source.amplitude,\r\n            frequency: source.frequency,\r\n            turnOffTime: source.turnOffTime\r\n        }\r\n    }\r\n\r\n    throw new Error(\"Unknown source: \" + JSON.stringify(source))\r\n}\r\n\r\nexport function descriptorToSignalSource(descriptor: SourceDescriptor): SignalSource {\r\n    if (descriptor.type === \"point\") {\r\n        return new PointSignalSource(descriptor.amplitude, descriptor.frequency, descriptor.position, descriptor.turnOffTime)\r\n    }\r\n\r\n    throw new Error(\"Unknown source type: \" + descriptor.type)\r\n}\r\n\r\nexport function encodeSimulatorMap(simulatorMap: SimulatorMap): EncodedSimulatorMap {\r\n    return {\r\n        simulationSettings: simulatorMap.simulationSettings,\r\n        sourceDescriptors: simulatorMap.sourceDescriptors,\r\n        encodedMaterialMap: encodeMaterialMap(simulatorMap.materialMap),\r\n        version: currentSimulatorMapVersion\r\n    }\r\n}\r\n\r\nexport function decodeSimulatorMap(encodedSimulatorMap: EncodedSimulatorMap): SimulatorMap {\r\n    const version = encodedSimulatorMap.version\r\n\r\n    const materialMap = version === undefined ? decodeMaterialMap_v0(encodedSimulatorMap.encodedMaterialMap) : decodeMaterialMap(encodedSimulatorMap.encodedMaterialMap)\r\n\r\n    return {\r\n        simulationSettings: encodedSimulatorMap.simulationSettings,\r\n        sourceDescriptors: encodedSimulatorMap.sourceDescriptors,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function encodeMaterialMap(materialMap: MaterialMap): string {\r\n    const materialMapArray = new Float32Array(2 + 3 * materialMap.shape[0] * materialMap.shape[1])\r\n\r\n    materialMapArray[0] = materialMap.shape[0]\r\n    materialMapArray[1] = materialMap.shape[1]\r\n\r\n    for (let y = 0; y < materialMap.shape[1]; y++) {\r\n        for (let x = 0; x < materialMap.shape[0]; x++) {\r\n            const index = y * materialMap.shape[0] * 3 + x * 3\r\n            materialMapArray[2 + index] = materialMap.permittivity[y][x]\r\n            materialMapArray[2 + index + 1] = materialMap.permeability[y][x]\r\n            materialMapArray[2 + index + 2] = materialMap.conductivity[y][x]\r\n        }\r\n    }\r\n\r\n    const encodedMaterialMap: EncodedMaterialMap = pako.deflate(new Uint8Array(materialMapArray.buffer), { to: \"string\" })\r\n    return encodedMaterialMap\r\n}\r\n\r\nexport function decodeMaterialMap_v0(encodedMaterialMap: EncodedMaterialMap): MaterialMap {\r\n    const materialMapArray = new Float32Array(pako.inflate(encodedMaterialMap).buffer)\r\n    const shape: [number, number] = [materialMapArray[0], materialMapArray[1]]\r\n\r\n    const permittivity: number[][] = []\r\n    const permeability: number[][] = []\r\n    const conductivity: number[][] = [] // added later, use default value of 0\r\n\r\n    for (let y = 0; y < shape[1]; y++) {\r\n        permittivity.push([])\r\n        permeability.push([])\r\n        conductivity.push([])\r\n        for (let x = 0; x < shape[0]; x++) {\r\n            const index = y * shape[0] * 2 + x * 2\r\n            permittivity[y].push(materialMapArray[2 + index])\r\n            permeability[y].push(materialMapArray[2 + index + 1])\r\n            conductivity[y].push(0)\r\n        }\r\n    }\r\n\r\n    return {\r\n        shape: shape,\r\n        permittivity: permittivity,\r\n        permeability: permeability,\r\n        conductivity: conductivity\r\n    }\r\n}\r\n\r\nexport function decodeMaterialMap(encodedMaterialMap: EncodedMaterialMap): MaterialMap {\r\n    const materialMapArray = new Float32Array(pako.inflate(encodedMaterialMap).buffer)\r\n    const shape: [number, number] = [materialMapArray[0], materialMapArray[1]]\r\n\r\n    const permittivity: number[][] = []\r\n    const permeability: number[][] = []\r\n    const conductivity: number[][] = []\r\n\r\n    for (let y = 0; y < shape[1]; y++) {\r\n        permittivity.push([])\r\n        permeability.push([])\r\n        conductivity.push([])\r\n        for (let x = 0; x < shape[0]; x++) {\r\n            const index = y * shape[0] * 3 + x * 3\r\n            permittivity[y].push(materialMapArray[2 + index])\r\n            permeability[y].push(materialMapArray[2 + index + 1])\r\n            conductivity[y].push(materialMapArray[2 + index + 2])\r\n        }\r\n    }\r\n\r\n    return {\r\n        shape: shape,\r\n        permittivity: permittivity,\r\n        permeability: permeability,\r\n        conductivity: conductivity\r\n    }\r\n}","export function toggleFullScreen() {\r\n    if (!document.fullscreenElement) {\r\n        document.documentElement.requestFullscreen()\r\n    } else if (document.exitFullscreen) {\r\n        document.exitFullscreen()\r\n    }\r\n}\r\n\r\nexport function clamp(min: number, max: number, value: number) {\r\n    return Math.max(min, Math.min(max, value))\r\n}\r\n\r\nexport type QualityPreset = {\r\n    dt: number\r\n    cellSize: number\r\n    gridSizeLongest: number\r\n    resolutionScale: number\r\n}\r\n\r\nexport const qualityPresets: { [presetName: string]: QualityPreset } = {\r\n    \"Low\": {\r\n        dt: 0.013 * 2,\r\n        cellSize: 0.02 * 2,\r\n        resolutionScale: 0.3,\r\n        gridSizeLongest: 400 / 2\r\n    },\r\n    \"Medium\": {\r\n        dt: 0.013,\r\n        cellSize: 0.02,\r\n        resolutionScale: 1,\r\n        gridSizeLongest: 400\r\n    },\r\n    \"High\": {\r\n        dt: 0.013 / 2,\r\n        cellSize: 0.02 / 2,\r\n        resolutionScale: 1,\r\n        gridSizeLongest: 400 * 2\r\n    },\r\n    \"Ultra\": {\r\n        dt: 0.013 / 4,\r\n        cellSize: 0.02 / 4,\r\n        resolutionScale: 1,\r\n        gridSizeLongest: 400 * 4\r\n    }\r\n}","import React, { ReactElement, useState, useCallback, useMemo, useRef, useEffect, MouseEventHandler } from \"react\"\r\nimport { SimulatorMap, SimulationSettings } from \"./em/serialization\"\r\nimport { EMState } from \"./em\"\r\nimport { DrawShape, makeDrawSquareInfo, makeDrawEllipseInfo } from \"./em/drawing\"\r\nimport { PointSignalSource } from \"./em/sources\"\r\nimport * as maps from \"./em/maps\"\r\nimport { QualityPreset, toggleFullScreen } from \"./util\"\r\nimport { BounceLoader } from \"react-spinners\"\r\nimport * as Icon from \"./icons\"\r\n\r\nexport type CollapsibleContainerProps = {\r\n    children?: ReactElement<any> | ReactElement<any>[]\r\n    id?: string\r\n    className?: string\r\n    style?: React.CSSProperties\r\n    buttonStyle?: React.CSSProperties\r\n    title?: string\r\n    collapsed: boolean\r\n    setCollapsed: (collapsed: boolean) => void\r\n}\r\n\r\nexport function CollapsibleContainer(props: CollapsibleContainerProps) {\r\n    const { collapsed, setCollapsed, id, className, buttonStyle, style, children, title } = props\r\n\r\n    return (\r\n        <div id={id} className={className} style={{\r\n            textAlign: \"center\", background: \"rgb(33, 33, 33)\",\r\n            fontWeight: \"lighter\", color: \"white\", height: \"400px\", ...style\r\n        }}>\r\n            <button onClick={e => setCollapsed(!collapsed)} style={{\r\n                width: \"30px\", float: \"left\", height: \"100%\", background: \"rgb(50, 50, 50)\",\r\n                border: \"0px\", color: \"white\", fontWeight: \"bold\", fontSize: \"20px\",\r\n                cursor: \"pointer\", ...buttonStyle\r\n            }}>\r\n                {collapsed ? \"<\" : \">\"}\r\n            </button>\r\n            <div style={{ float: \"right\" }}>\r\n                {!collapsed && (<div>\r\n                    <div style={{ fontSize: \"20px\", marginTop: \"4px\" }}>{title}</div>\r\n                    {children}\r\n                </div>)}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type LabeledSliderProps = {\r\n    label: string\r\n    value: number,\r\n    setValue: (value: number) => void\r\n    min: number\r\n    max: number\r\n    step: number\r\n    allowNegative?: boolean\r\n    logarithmic?: boolean\r\n    displayDigits?: number\r\n}\r\n\r\nexport function LabeledSlider(props: LabeledSliderProps) {\r\n    const { value, setValue, allowNegative, logarithmic, displayDigits } = props\r\n    const absValue = logarithmic ? Math.log2(Math.abs(value)) : Math.abs(value)\r\n\r\n    const [negative, setNegative] = useState(value < 0)\r\n\r\n    const rangeSliderRef = useRef<HTMLInputElement>(null)\r\n\r\n    const updateValue = useCallback(() => {\r\n        if (rangeSliderRef.current) {\r\n            let newValue = parseFloat(rangeSliderRef.current.value)\r\n            if (logarithmic) {\r\n                newValue = Math.pow(2, newValue)\r\n            }\r\n\r\n            setValue((negative ? -1 : 1) * newValue)\r\n        }\r\n    }, [setValue, negative, logarithmic, rangeSliderRef])\r\n\r\n    useEffect(() => updateValue(), [negative, updateValue])\r\n\r\n    const displayValue = (displayDigits !== undefined) ? value.toFixed(displayDigits) : value\r\n\r\n    return (\r\n        <div>\r\n            <label>{props.label}</label>\r\n            {allowNegative && <>\r\n                <input style={{ marginLeft: \"10px\" }} type=\"checkbox\" checked={negative} onChange={e => setNegative(e.target.checked)} />\r\n                <label>Negative</label>\r\n            </>}\r\n            <div>\r\n                <input type=\"range\" ref={rangeSliderRef} min={props.min} max={props.max} value={absValue} step={props.step}\r\n                    onChange={updateValue} style={{ height: 10, width: \"100%\" }} />\r\n                <div style={{ textAlign: \"center\", lineHeight: 0.2, marginBottom: \"7px\" }}>\r\n                    {displayValue}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type OptionSelectorProps = {\r\n    options: string[]\r\n    selectedOption: number\r\n    setSelectedOption: (selectedOption: number) => void\r\n    style?: React.CSSProperties\r\n    buttonStyle?: React.CSSProperties\r\n}\r\n\r\nexport function OptionSelector(props: OptionSelectorProps) {\r\n    return (\r\n        <div style={props.style}>\r\n            {props.options.map((option, optionIndex) =>\r\n                <button key={option} style={{\r\n                    backgroundColor: \"rgb(50, 50, 50)\",\r\n                    color: \"white\",\r\n                    border: optionIndex === props.selectedOption ? \"3px solid rgb(0, 150, 255)\" : \"0\",\r\n                    height: \"30px\",\r\n                    width: \"70px\",\r\n                    overflow: \"hidden\",\r\n                    textOverflow: \"hidden\",\r\n                    ...props.buttonStyle\r\n                }}\r\n                    onClick={e => props.setSelectedOption(optionIndex)}>\r\n                    {option}\r\n                </button>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type ExamplesComponentProps = {\r\n    em: EMState | null\r\n\r\n    dt: number\r\n    simulationSpeed: number\r\n    cellSize: number\r\n    gridSize: [number, number]\r\n\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n    setDt: (dt: number) => void\r\n    setCellSize: (cellSize: number) => void\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n}\r\n\r\nexport function ExamplesComponent(props: ExamplesComponentProps) {\r\n    const { em, setGridSizeLongest, setDt, setCellSize, setSimulationSpeed } = props\r\n\r\n    const loadMap = useCallback((simulatorMap: SimulatorMap) => {\r\n        if (em) {\r\n            em.resetFields()\r\n            em.loadMaterialFromComponents(\r\n                simulatorMap.materialMap.permittivity,\r\n                simulatorMap.materialMap.permeability,\r\n                simulatorMap.materialMap.conductivity\r\n            )\r\n\r\n            const loadedSources = simulatorMap.sourceDescriptors.map(desc => {\r\n                if (desc.type === \"point\") {\r\n                    return new PointSignalSource(desc.amplitude, desc.frequency, desc.position, desc.turnOffTime)\r\n                }\r\n\r\n                throw new Error(`Unsupported source type: ${desc.type}`)\r\n            })\r\n\r\n            setCellSize(simulatorMap.simulationSettings.cellSize)\r\n            setDt(simulatorMap.simulationSettings.dt)\r\n            setSimulationSpeed(simulatorMap.simulationSettings.simulationSpeed)\r\n            setGridSizeLongest(Math.max(simulatorMap.simulationSettings.gridSize[0], simulatorMap.simulationSettings.gridSize[1]))\r\n            em.setSources(loadedSources)\r\n        }\r\n    }, [em, setCellSize, setDt, setSimulationSpeed, setGridSizeLongest])\r\n\r\n    const simulationSettings = useMemo<SimulationSettings>(() => {\r\n        return {\r\n            dt: props.dt,\r\n            cellSize: props.cellSize,\r\n            gridSize: props.gridSize,\r\n            simulationSpeed: props.simulationSpeed\r\n        }\r\n    }, [props.dt, props.cellSize, props.gridSize, props.simulationSpeed])\r\n\r\n    return (\r\n        <div style={{ padding: \"5px\", width: \"150px\" }}>\r\n            <div><button onClick={_ => loadMap(maps.empty(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", width: \"100%\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Empty</button></div>\r\n            <div><button onClick={_ => loadMap(maps.doubleSlit(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", width: \"100%\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Double slit</button></div>\r\n            <div><button onClick={_ => loadMap(maps.fiberOptics(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", width: \"100%\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Fiber optics</button></div>\r\n            <div><button onClick={_ => loadMap(maps.lens(simulationSettings))} style={{ backgroundColor: \"rgb(50, 50, 50)\", width: \"100%\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Lens</button></div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SettingsComponentProps = {\r\n    gridSizeLongest: number\r\n    setGridSizeLongest: (gridSizeLongest: number) => void\r\n\r\n    dt: number\r\n    setDt: (dt: number) => void\r\n\r\n    cellSize: number\r\n    setCellSize: (cellSize: number) => void\r\n\r\n    resolutionScale: number\r\n    setResolutionScale: (resolutionScale: number) => void\r\n\r\n    simulationSpeed: number\r\n    setSimulationSpeed: (simulationSpeed: number) => void\r\n\r\n    reflectiveBoundary: boolean\r\n    setReflectiveBoundary: (reflectiveBoundary: boolean) => void\r\n\r\n    qualityPresets: { [presetName: string]: QualityPreset }\r\n}\r\n\r\nexport function SettingsComponent(props: SettingsComponentProps) {\r\n    const { qualityPresets, setCellSize, setGridSizeLongest, setResolutionScale, setDt } = props\r\n\r\n    const onPresetClicked = useCallback((preset: QualityPreset) => {\r\n        setCellSize(preset.cellSize)\r\n        setGridSizeLongest(preset.gridSizeLongest)\r\n        setResolutionScale(preset.resolutionScale)\r\n        setDt(preset.dt)\r\n    }, [setCellSize, setGridSizeLongest, setResolutionScale, setDt])\r\n\r\n    return (\r\n        <div style={{ padding: \"5px\" }}>\r\n            <div>Quality presets</div>\r\n            <div>\r\n                {Object.keys(qualityPresets).map(presetName =>\r\n                    <button key={presetName} onClick={_ => onPresetClicked(qualityPresets[presetName])}\r\n                        style={{ backgroundColor: \"rgb(50, 50, 50)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>\r\n                        {presetName}\r\n                    </button>\r\n                )}\r\n            </div>\r\n            <LabeledSlider label=\"Grid length\" value={props.gridSizeLongest} setValue={props.setGridSizeLongest} min={100} max={2000} step={100} />\r\n            <LabeledSlider label=\"Time step size\" value={props.dt} setValue={props.setDt} min={0.001} max={0.1} step={0.001} allowNegative={true} />\r\n            <LabeledSlider label=\"Cell size\" value={props.cellSize} setValue={props.setCellSize} min={0.002} max={0.2} step={0.001} />\r\n            <LabeledSlider label=\"Resolution scale\" value={props.resolutionScale} setValue={props.setResolutionScale} min={0.1} max={2} step={0.1} />\r\n            <LabeledSlider label=\"Simulation speed\" value={props.simulationSpeed} setValue={props.setSimulationSpeed} min={0} max={10} step={0.1} />\r\n            <input type=\"checkbox\" checked={props.reflectiveBoundary} onChange={e => props.setReflectiveBoundary(e.target.checked)} />Reflective boundary\r\n        </div>\r\n    )\r\n}\r\n\r\ntype ImageButtonProps = {\r\n    onClick?: MouseEventHandler<HTMLButtonElement>\r\n    src?: string\r\n    size?: number\r\n    highlight?: boolean\r\n}\r\n\r\nexport function ImageButton(props: ImageButtonProps) {\r\n    const size = props.size || 48\r\n\r\n    return (\r\n        <button onClick={props.onClick} style={{ margin: \"2px\", padding: \"5px\", background: \"transparent\", border: props.highlight ? \"2px solid rgb(0, 150, 255)\" : \"2px solid transparent\", borderRadius: \"10px\", lineHeight: 0 }}>\r\n            <img width={size} height={size} src={props.src} alt=\"\" style={{ width: size, height: size }} />\r\n        </button>\r\n    )\r\n}\r\n\r\nexport type ShareComponentProps = {\r\n    shareUrl: string\r\n    shareTitle: string\r\n    shareText: string\r\n}\r\n\r\nexport function ShareComponent(props: ShareComponentProps) {\r\n    const { shareTitle, shareText, shareUrl } = props\r\n\r\n    const shareUrlTextRef = useRef<HTMLInputElement>(null)\r\n\r\n    const onCopyClicked = useCallback(() => {\r\n        if (shareUrlTextRef.current) {\r\n            shareUrlTextRef.current.select()\r\n            document.execCommand(\"copy\")\r\n        }\r\n    }, [shareUrlTextRef])\r\n\r\n    const onShareClicked = useCallback(() => {\r\n        const nav = navigator as any\r\n        if (nav.share) {\r\n            nav.share({\r\n                title: shareTitle,\r\n                text: shareText,\r\n                url: shareUrl\r\n            }).then(() => console.log(\"Shared\")).catch((err: any) => console.error(`Share failed: ${err}`))\r\n        }\r\n    }, [shareUrl, shareTitle, shareText])\r\n\r\n    return (\r\n        <div style={{ padding: \"5px\" }}>\r\n            {shareUrl &&\r\n                <>\r\n                    <div>\r\n                        <input ref={shareUrlTextRef} readOnly type=\"text\" value={shareUrl} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\", width: \"70%\" }} />\r\n                        <button onClick={onCopyClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", color: \"white\", margin: \"2px\" }}>Copy</button>\r\n                    </div>\r\n                    <div>\r\n                        {(navigator as any).share !== undefined && <button onClick={onShareClicked} style={{ background: \"rgba(50, 50, 50, 100)\", border: \"0px\", width: \"80%\", fontSize: \"24px\", color: \"white\", margin: \"2px\" }}>Share</button>}\r\n                    </div>\r\n                </>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type MaterialBrushMenuProps = {\r\n    materialBrushSize: number\r\n    setMaterialBrushSize: (brushSize: number) => void\r\n\r\n    permeabilityBrushValue: number\r\n    setPermeabilityBrushValue: (brushValue: number) => void\r\n\r\n    permittivityBrushValue: number\r\n    setPermittivityBrushValue: (brushValue: number) => void\r\n\r\n    conductivityBrushValue: number\r\n    setConductivityBrushValue: (brushValue: number) => void\r\n\r\n    activeBrushShape: DrawShape\r\n    setActiveBrushDrawShape: (drawShape: DrawShape) => void\r\n\r\n    snapInput: boolean\r\n    setSnapInput: (snapInput: boolean) => void\r\n}\r\n\r\nexport function MaterialBrushMenu(props: MaterialBrushMenuProps) {\r\n    const { activeBrushShape, setActiveBrushDrawShape } = props\r\n\r\n    const brushShapeIndex = useMemo(() => activeBrushShape === DrawShape.Square ? 0 : 1, [activeBrushShape])\r\n    const setBrushShapeIndex = useCallback((index: number) => setActiveBrushDrawShape(index === 0 ? DrawShape.Square : DrawShape.Ellipse), [setActiveBrushDrawShape])\r\n\r\n    const brushSizeLabel = useMemo(() => activeBrushShape === DrawShape.Square ? \"Brush size\" : \"Brush radius\", [activeBrushShape])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <input type=\"checkbox\" checked={props.snapInput} onChange={e => props.setSnapInput(e.target.checked)} />\r\n            <label>Snap to 45 line</label>\r\n            <OptionSelector buttonStyle={{ height: \"24px\" }} options={[\"Square\", \"Circle\"]}\r\n                selectedOption={brushShapeIndex} setSelectedOption={setBrushShapeIndex} />\r\n            <div>\r\n                <LabeledSlider label={brushSizeLabel} value={props.materialBrushSize}\r\n                    setValue={props.setMaterialBrushSize} min={1} max={100} step={1} />\r\n                <LabeledSlider label=\" value\" value={props.permittivityBrushValue}\r\n                    setValue={props.setPermittivityBrushValue} min={-1} max={10} step={0.1} allowNegative={true} logarithmic={true} displayDigits={1} />\r\n                <LabeledSlider label=\" value\" value={props.permeabilityBrushValue}\r\n                    setValue={props.setPermeabilityBrushValue} min={-1} max={10} step={0.1} allowNegative={true} logarithmic={true} displayDigits={1} />\r\n                <LabeledSlider label=\" value\" value={props.conductivityBrushValue}\r\n                    setValue={props.setConductivityBrushValue} min={0} max={20} step={0.25} allowNegative={true} />\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport type SignalBrushMenuProps = {\r\n    signalBrushSize: number\r\n    setSignalBrushSize: (brushSize: number) => void\r\n\r\n    signalBrushValue: number\r\n    setSignalBrushValue: (brushValue: number) => void\r\n\r\n    signalFrequency: number\r\n    setSignalFrequency: (signalFrequency: number) => void\r\n\r\n    activeBrushShape: DrawShape\r\n    setActiveBrushDrawShape: (brushShape: DrawShape) => void\r\n\r\n    snapInput: boolean\r\n    setSnapInput: (snapInput: boolean) => void\r\n}\r\n\r\nexport function SignalBrushMenu(props: SignalBrushMenuProps) {\r\n    const { activeBrushShape, setActiveBrushDrawShape } = props\r\n\r\n    const brushShapeIndex = useMemo(() => activeBrushShape === DrawShape.Square ? 0 : 1, [activeBrushShape])\r\n    const setBrushShapeIndex = useCallback((index: number) => setActiveBrushDrawShape(index === 0 ? DrawShape.Square : DrawShape.Ellipse), [setActiveBrushDrawShape])\r\n\r\n    const brushSizeLabel = useMemo(() => activeBrushShape === DrawShape.Square ? \"Brush size\" : \"Brush radius\", [activeBrushShape])\r\n\r\n    return (\r\n        <div style={{ padding: \"10px\" }}>\r\n            <input type=\"checkbox\" checked={props.snapInput} onChange={e => props.setSnapInput(e.target.checked)} />\r\n            <label>Snap to 45 line</label>\r\n            <OptionSelector buttonStyle={{ height: \"24px\" }} options={[\"Square\", \"Circle\"]}\r\n                selectedOption={brushShapeIndex} setSelectedOption={setBrushShapeIndex} />\r\n            <div>\r\n                <LabeledSlider label={brushSizeLabel} value={props.signalBrushSize}\r\n                    setValue={props.setSignalBrushSize} min={1} max={100} step={1} />\r\n                <LabeledSlider label=\"Signal amplitude\" value={props.signalBrushValue}\r\n                    setValue={props.setSignalBrushValue} min={1} max={100} step={1} />\r\n                <LabeledSlider label=\"Signal frequency\" value={props.signalFrequency}\r\n                    setValue={props.setSignalFrequency} min={0} max={25} step={0.25} />\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\ntype MultiMenuChildProps<TState> = {\r\n    children?: ReactElement<any>\r\n    activateForState: TState\r\n}\r\n\r\nexport function MultiMenuChild<TState>(props: MultiMenuChildProps<TState>) {\r\n    return <>\r\n        {props.children}\r\n    </>\r\n}\r\n\r\nexport type MultiMenuProps<TState> = {\r\n    children?: ReactElement<MultiMenuChildProps<TState>>[]\r\n    activeState: TState\r\n}\r\n\r\nexport function MultiMenu<TState>(props: MultiMenuProps<TState>) {\r\n    const activeChildren = useMemo(() => {\r\n        return props.children?.filter(child => child.props.activateForState === props.activeState)\r\n    }, [props.activeState, props.children])\r\n\r\n    return <>\r\n        {activeChildren}\r\n    </>\r\n}\r\n\r\nexport type InfoBoxProps = {\r\n    visible: boolean\r\n    setVisible: (visible: boolean) => void\r\n}\r\n\r\nexport function InfoBox(props: InfoBoxProps) {\r\n    return <>{props.visible &&\r\n        <div>\r\n            <div onClick={_ => props.setVisible(false)} style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, background: \"rgba(0, 0, 0, 0.5)\" }} />\r\n            <div style={{ position: \"absolute\", backgroundColor: \"rgb(30, 30, 30)\", left: \"50%\", top: \"50%\", marginLeft: \"-150px\", marginTop: \"-70px\", width: \"300px\", height: \"140px\", textAlign: \"center\", padding: \"10px\", color: \"white\", fontWeight: \"lighter\" }}>\r\n                <div>\r\n                    Made by <a href=\"https://github.com/RobinKa\" style={{ textDecoration: \"none\", color: \"rgb(0, 150, 255)\" }} rel=\"noopener noreferrer\" target=\"_blank\">Robin Kahlow</a>. If you have feedback, ideas for improvement, bug reports or anything else open an issue on <a href=\"https://github.com/RobinKa/maxwell-simulation/issues\" style={{ textDecoration: \"none\", color: \"rgb(0, 150, 255)\" }} rel=\"noopener noreferrer\" target=\"_blank\">GitHub</a> or <a href=\"mailto:tora@warlock.ai?subject=EM simulation feedback\" style={{ textDecoration: \"none\", color: \"rgb(0, 150, 255)\" }}>send an email to tora@warlock.ai</a>.\r\n                </div>\r\n                <div style={{ marginTop: \"5px\" }}>\r\n                    <a href=\"https://github.com/RobinKa/maxwell-simulation\" style={{ textDecoration: \"none\", color: \"rgb(0, 150, 255)\" }} rel=\"noopener noreferrer\" target=\"_blank\">\r\n                        Source code\r\n                    </a>\r\n                </div>\r\n                <div style={{ marginTop: \"5px\" }}>\r\n                    Icons by <a href=\"https://icons8.com/\" style={{ textDecoration: \"none\", color: \"rgb(0, 150, 255)\" }} rel=\"noopener noreferrer\" target=\"_blank\">Icons8</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }</>\r\n}\r\n\r\nexport type LoadingIndicatorProps = {\r\n    visible: boolean\r\n}\r\n\r\nexport function LoadingIndicator(props: LoadingIndicatorProps) {\r\n    return <>{props.visible &&\r\n        <div>\r\n            <div style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, background: \"rgba(0, 0, 0, 0.5)\" }} />\r\n            <div style={{ position: \"absolute\", left: \"50%\", top: \"50%\", marginLeft: \"-75px\", marginTop: \"-75px\", width: \"150px\", height: \"150px\", textAlign: \"center\" }}>\r\n                <BounceLoader color=\"rgb(0, 150, 255)\" size={100} />\r\n            </div>\r\n        </div>\r\n    }</>\r\n}\r\n\r\nexport type ShareBoxProps = {\r\n    visible: boolean\r\n    setVisible: (visible: boolean) => void\r\n    shareInProgress: boolean\r\n    shareUrl: string | null\r\n}\r\n\r\nexport function ShareBox(props: ShareBoxProps) {\r\n    return <>{props.visible &&\r\n        <div>\r\n            <div onClick={_ => props.setVisible(false)} style={{ position: \"absolute\", left: 0, right: 0, top: 0, bottom: 0, background: \"rgba(0, 0, 0, 0.5)\" }} />\r\n            {!(props.shareInProgress || !props.shareUrl) &&\r\n                <div style={{ position: \"absolute\", backgroundColor: \"rgb(30, 30, 30)\", left: \"50%\", top: \"50%\", marginLeft: \"-150px\", marginTop: \"-30px\", width: \"300px\", height: \"60px\", textAlign: \"center\", padding: \"10px\" }}>\r\n                    <ShareComponent shareUrl={props.shareUrl} shareText=\"Check out what I made in this interactive web-based simulator for electromagnetic waves!\" shareTitle=\"EM Simulator\" />\r\n                </div>\r\n            }\r\n        </div>\r\n    }</>\r\n}\r\n\r\ntype ResetButtonsProps = {\r\n    resetMaterials: () => void\r\n    resetFields: () => void\r\n    extraStyle: React.CSSProperties\r\n}\r\n\r\nexport function ResetButtons(props: ResetButtonsProps) {\r\n    return (\r\n        <div style={{ position: \"absolute\", bottom: \"10px\", left: \"10px\", ...props.extraStyle }}>\r\n            <ImageButton onClick={props.resetFields} src={Icon.ResetFields} />\r\n            <ImageButton onClick={props.resetMaterials} src={Icon.ResetMaterials} />\r\n        </div>\r\n    )\r\n}\r\n\r\nexport enum SideBarType {\r\n    SignalBrush = \"Signal Brush\",\r\n    MaterialBrush = \"Material Brush\",\r\n    Settings = \"Settings\",\r\n    Examples = \"Examples\"\r\n}\r\n\r\nexport enum BrushType {\r\n    Material,\r\n    Signal\r\n}\r\n\r\ntype BrushSelectionButtonsProps = {\r\n    activeSideBar: SideBarType\r\n    setActiveSideBar: (sideBar: SideBarType) => void\r\n    setActiveBrush: (brush: BrushType) => void\r\n    extraStyle: React.CSSProperties\r\n}\r\n\r\nexport function BrushSelectionButtons(props: BrushSelectionButtonsProps) {\r\n    return (\r\n        <div style={{ position: \"absolute\", top: \"10px\", left: \"10px\", ...props.extraStyle }}>\r\n            <ImageButton onClick={_ => { props.setActiveSideBar(SideBarType.SignalBrush); props.setActiveBrush(BrushType.Signal) }} src={Icon.SignalBrush} highlight={props.activeSideBar === SideBarType.SignalBrush} />\r\n            <ImageButton onClick={_ => { props.setActiveSideBar(SideBarType.MaterialBrush); props.setActiveBrush(BrushType.Material) }} src={Icon.MaterialBrush} highlight={props.activeSideBar === SideBarType.MaterialBrush} />\r\n        </div>\r\n    )\r\n}\r\n\r\ntype MenuSelectionButtonsProps = {\r\n    activeSideBar: SideBarType\r\n    setActiveSideBar: (sideBar: SideBarType) => void\r\n    extraStyle: React.CSSProperties\r\n}\r\n\r\nexport function MenuSelectionButtons(props: MenuSelectionButtonsProps) {\r\n    return (\r\n        <div style={{ position: \"absolute\", top: \"10px\", right: \"10px\", ...props.extraStyle }}>\r\n            <ImageButton onClick={_ => props.setActiveSideBar(SideBarType.Examples)} src={Icon.Examples} highlight={props.activeSideBar === SideBarType.Examples} />\r\n            <ImageButton onClick={_ => props.setActiveSideBar(SideBarType.Settings)} src={Icon.Settings} highlight={props.activeSideBar === SideBarType.Settings} />\r\n            <ImageButton onClick={toggleFullScreen} src={Icon.Fullscreen} />\r\n        </div>\r\n    )\r\n}\r\n\r\ntype BrushCursorProps = {\r\n    brushShape: DrawShape\r\n    mousePosition: [number, number] | null\r\n    activeBrushSize: number\r\n}\r\n\r\nexport function BrushCursor(props: BrushCursorProps) {\r\n    const cursorStyle = useMemo(() => {\r\n        if (props.mousePosition) {\r\n            const style: React.CSSProperties = {\r\n                position: \"absolute\",\r\n                pointerEvents: \"none\",\r\n                left: props.mousePosition[0] - props.activeBrushSize / 2,\r\n                top: props.mousePosition[1] - props.activeBrushSize / 2,\r\n                width: props.activeBrushSize,\r\n                height: props.activeBrushSize,\r\n                border: \"2px solid rgb(255, 89, 0)\"\r\n            }\r\n\r\n            if (props.brushShape === DrawShape.Ellipse) {\r\n                style.borderRadius = \"50%\"\r\n            }\r\n\r\n            return style\r\n        }\r\n\r\n        return null\r\n    }, [props])\r\n\r\n    return <>\r\n        {cursorStyle && <div style={cursorStyle} />}\r\n    </>\r\n}\r\n\r\ntype MiscButtonsProps = {\r\n    generateShareUrl: () => void\r\n    shareVisible: boolean\r\n    setShareVisible: (shareVisible: boolean) => void\r\n    extraStyle: React.CSSProperties\r\n    infoVisible: boolean\r\n    setInfoVisible: (infoVisible: boolean) => void\r\n}\r\n\r\nexport function MiscButtons(props: MiscButtonsProps) {\r\n    return (\r\n        <div style={{ position: \"absolute\", bottom: 10, right: 10, ...props.extraStyle }}>\r\n            <ImageButton onClick={_ => { props.generateShareUrl(); props.setShareVisible(!props.shareVisible) }} src={Icon.Share} highlight={props.shareVisible} />\r\n            <ImageButton onClick={_ => props.setInfoVisible(!props.infoVisible)} src={Icon.Info} />\r\n            <a href=\"https://github.com/RobinKa/maxwell-simulation\"><ImageButton src={Icon.GitHub} /></a>\r\n        </div>\r\n    )\r\n}\r\n\r\ntype InteractiveCanvasProps = {\r\n    em: EMState | null\r\n    gridSize: [number, number]\r\n    materialBrushSize: number\r\n    permittivityBrushValue: number\r\n    permeabilityBrushValue: number\r\n    conductivityBrushValue: number\r\n    activeBrushShape: DrawShape\r\n    windowToSimulationPoint: (windowPoint: [number, number]) => [number, number]\r\n    activeBrush: BrushType\r\n    mouseDownPos: React.MutableRefObject<[number, number] | null>\r\n    setIsInputDown: (isInputDown: boolean) => void\r\n    snapInput: boolean\r\n    windowSize: [number, number]\r\n    canvasSize: [number, number]\r\n    setMousePosition: (mousePosition: [number, number] | null) => void\r\n    drawCanvasRef: React.RefObject<HTMLCanvasElement>\r\n}\r\n\r\nexport function InteractiveCanvas(props: InteractiveCanvasProps) {\r\n    const {\r\n        em, gridSize, materialBrushSize, permittivityBrushValue,\r\n        permeabilityBrushValue, conductivityBrushValue, activeBrushShape,\r\n        windowToSimulationPoint, activeBrush, mouseDownPos, setIsInputDown,\r\n        snapInput, windowSize, canvasSize, setMousePosition, drawCanvasRef\r\n    } = props\r\n\r\n    const changeMaterial = useCallback((canvasPos: [number, number]) => {\r\n        if (em) {\r\n            const center: [number, number] = windowToSimulationPoint(canvasPos)\r\n            const brushHalfSize: [number, number] = [\r\n                materialBrushSize / gridSize[0] / 2,\r\n                materialBrushSize / gridSize[1] / 2\r\n            ]\r\n\r\n            em.drawMaterial(\"permittivity\", activeBrushShape === DrawShape.Square ?\r\n                makeDrawSquareInfo(center, brushHalfSize, permittivityBrushValue) :\r\n                makeDrawEllipseInfo(center, brushHalfSize, permittivityBrushValue))\r\n\r\n            em.drawMaterial(\"permeability\", activeBrushShape === DrawShape.Square ?\r\n                makeDrawSquareInfo(center, brushHalfSize, permeabilityBrushValue) :\r\n                makeDrawEllipseInfo(center, brushHalfSize, permeabilityBrushValue))\r\n\r\n            em.drawMaterial(\"conductivity\", activeBrushShape === DrawShape.Square ?\r\n                makeDrawSquareInfo(center, brushHalfSize, conductivityBrushValue) :\r\n                makeDrawEllipseInfo(center, brushHalfSize, conductivityBrushValue))\r\n        }\r\n    }, [em, gridSize, materialBrushSize, permittivityBrushValue, permeabilityBrushValue, conductivityBrushValue, activeBrushShape, windowToSimulationPoint])\r\n\r\n    const [drawingMaterial, setDrawingMaterial] = useState(false)\r\n    const [inputStartPos, setInputStartPos] = useState<[number, number] | null>(null)\r\n    const [inputDir, setInputDir] = useState<[number, number] | null>(null)\r\n\r\n    const onInputDown = useCallback((clientPos: [number, number]) => {\r\n        setInputStartPos(clientPos)\r\n\r\n        if (activeBrush === BrushType.Signal) {\r\n            mouseDownPos.current = clientPos\r\n        } else if (activeBrush === BrushType.Material) {\r\n            changeMaterial(clientPos)\r\n            setDrawingMaterial(true)\r\n        }\r\n\r\n        setIsInputDown(true)\r\n    }, [changeMaterial, activeBrush, mouseDownPos, setIsInputDown])\r\n\r\n    const onInputMove = useCallback((clientPos: [number, number], shiftDown?: boolean) => {\r\n        let pos: [number, number] = clientPos\r\n\r\n        // If snapping, change the position to lie along the draw line\r\n        if ((snapInput || shiftDown) && inputStartPos) {\r\n            const offset = [pos[0] - inputStartPos[0], pos[1] - inputStartPos[1]]\r\n            if (inputDir) {\r\n                const projection = offset[0] * inputDir[0] + offset[1] * inputDir[1]\r\n                pos = [inputStartPos[0] + projection * inputDir[0], inputStartPos[1] + projection * inputDir[1]]\r\n            } else {\r\n                const offsetLengthSq = offset[0] * offset[0] + offset[1] * offset[1]\r\n                const minimumSnapLengthSq = 0.01 * 0.01 * (windowSize[0] * windowSize[0] + windowSize[1] * windowSize[1])\r\n                if (offsetLengthSq > minimumSnapLengthSq) {\r\n                    // Snap to discrete angles\r\n                    const angleQuantum = Math.PI / 4\r\n                    const snappedAngle = Math.round(Math.atan2(offset[1], offset[0]) / angleQuantum) * angleQuantum\r\n                    const dir: [number, number] = [Math.cos(snappedAngle), Math.sin(snappedAngle)]\r\n                    setInputDir(dir)\r\n                }\r\n            }\r\n        }\r\n\r\n        if (activeBrush === BrushType.Signal && mouseDownPos.current !== null) {\r\n            mouseDownPos.current = pos\r\n        }\r\n\r\n        if (drawingMaterial) {\r\n            changeMaterial(pos)\r\n        }\r\n    }, [changeMaterial, activeBrush, drawingMaterial, inputDir, inputStartPos, windowSize, snapInput, mouseDownPos])\r\n\r\n    const onInputUp = useCallback(() => {\r\n        if (activeBrush === BrushType.Signal) {\r\n            mouseDownPos.current = null\r\n        } else if (activeBrush === BrushType.Material) {\r\n            setDrawingMaterial(false)\r\n        }\r\n\r\n        setInputDir(null)\r\n        setInputStartPos(null)\r\n\r\n        setIsInputDown(false)\r\n    }, [activeBrush, mouseDownPos, setIsInputDown])\r\n\r\n    return (\r\n        <canvas width={canvasSize[0]} height={canvasSize[1]} ref={drawCanvasRef} style={{ position: \"absolute\", width: windowSize[0], height: windowSize[1], cursor: \"none\" }}\r\n            onMouseDown={e => onInputDown([e.clientX, e.clientY])}\r\n            onMouseMove={e => { setMousePosition([e.clientX, e.clientY]); onInputMove([e.clientX, e.clientY], e.shiftKey) }}\r\n            onMouseUp={e => onInputUp()}\r\n            onMouseLeave={e => onInputUp()}\r\n            onTouchStart={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputDown([e.touches[0].clientX, e.touches[0].clientY]) }}\r\n            onTouchMove={e => { setMousePosition([e.touches[0].clientX, e.touches[0].clientY]); onInputMove([e.touches[0].clientX, e.touches[0].clientY]) }}\r\n            onTouchEnd={e => { setMousePosition(null); onInputUp() }}\r\n            onTouchCancel={e => { setMousePosition(null); onInputUp() }}\r\n            onContextMenu={e => e.preventDefault()}\r\n        />\r\n    )\r\n}\r\n\r\ntype FullscreenViewProps = {\r\n    children?: ReactElement<any> | ReactElement<any>[]\r\n}\r\n\r\nexport function FullscreenView(props: FullscreenViewProps) {\r\n    return (\r\n        <div style={{ position: \"absolute\", top: 0, left: 0, right: 0, bottom: 0, touchAction: \"none\", userSelect: \"none\" }}>\r\n            {props.children}\r\n        </div>\r\n    )\r\n}","import { SimulatorMap, MaterialMap, SourceDescriptor, SimulationSettings } from \"./serialization\"\r\n\r\nexport function empty(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        conductivity: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.conductivity.push(new Array(simulationSettings.gridSize[0]).fill(0))\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = []\r\n\r\n    return {\r\n        sourceDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function doubleSlit(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        conductivity: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    const slitCenterX = Math.round(0.5 * simulationSettings.gridSize[0])\r\n\r\n    const slitSize = 0.2 / simulationSettings.cellSize\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        const isWallRow = Math.abs(y - simulationSettings.gridSize[1] * 4 / 5) < 2\r\n        const permittivityRow = new Array(simulationSettings.gridSize[0]).fill(isWallRow ? 100 : 1)\r\n\r\n        if (isWallRow) {\r\n            for (let x = slitCenterX - slitSize * 2; x < slitCenterX - slitSize; x++) {\r\n                permittivityRow[x] = 1\r\n            }\r\n\r\n            for (let x = slitCenterX + slitSize * 2; x > slitCenterX + slitSize; x--) {\r\n                permittivityRow[x] = 1\r\n            }\r\n        }\r\n\r\n        materialMap.permittivity.push(permittivityRow)\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.conductivity.push(new Array(simulationSettings.gridSize[0]).fill(0))\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 30000,\r\n        frequency: 3,\r\n        position: [0.5, 14.5 / 15]\r\n    }]\r\n\r\n    return {\r\n        sourceDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function fiberOptics(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        conductivity: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.conductivity.push(new Array(simulationSettings.gridSize[0]).fill(0))\r\n    }\r\n\r\n    function getCurvePoint(t: number): [number, number] {\r\n        return [\r\n            Math.round(simulationSettings.gridSize[0] * 0.5 + simulationSettings.gridSize[0] / 5 * 0.5 / (2 * t + 1) * -Math.sin(2 * Math.PI * t)),\r\n            Math.round(simulationSettings.gridSize[1] * (1 / 10 + t * (1 - 2 / 10)))\r\n        ]\r\n    }\r\n\r\n    const numPoints = 100\r\n    const thickness = 0.04 / simulationSettings.cellSize\r\n    for (let t = 0; t < numPoints; t++) {\r\n        const pos = getCurvePoint(t / numPoints)\r\n\r\n        for (let x = -thickness + pos[0]; x < thickness + pos[0]; x++) {\r\n            for (let y = -thickness + pos[1]; y < thickness + pos[1]; y++) {\r\n                if (x >= 0 && y >= 0 && x < simulationSettings.gridSize[0] && y < simulationSettings.gridSize[1]) {\r\n                    materialMap.permittivity[y][x] = 2\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const endPoint = getCurvePoint(1)\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 10000,\r\n        frequency: 5,\r\n        position: [(endPoint[0] - 1) / simulationSettings.gridSize[0], 1 - endPoint[1] / simulationSettings.gridSize[1]],\r\n        turnOffTime: 0.5\r\n    }, {\r\n        type: \"point\",\r\n        amplitude: 10000,\r\n        frequency: 5,\r\n        position: [(endPoint[0] + 2) / simulationSettings.gridSize[0], 1 - endPoint[1] / simulationSettings.gridSize[1]],\r\n        turnOffTime: 0.5\r\n    },]\r\n\r\n    return {\r\n        sourceDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}\r\n\r\nexport function lens(simulationSettings: SimulationSettings): SimulatorMap {\r\n    const materialMap: MaterialMap = {\r\n        permittivity: [],\r\n        permeability: [],\r\n        conductivity: [],\r\n        shape: simulationSettings.gridSize\r\n    }\r\n\r\n    const center = [simulationSettings.gridSize[0] * 0.6, simulationSettings.gridSize[1] / 2]\r\n\r\n    function isLensPoint(point: [number, number]) {\r\n        const dx = point[0] - center[0]\r\n        const dy = point[1] - center[1]\r\n\r\n        return 4 * dx * dx + dy * dy < simulationSettings.gridSize[0] * simulationSettings.gridSize[0] / (10 * 10)\r\n    }\r\n\r\n    for (let y = 0; y < simulationSettings.gridSize[1]; y++) {\r\n        materialMap.permittivity.push([])\r\n        materialMap.permeability.push(new Array(simulationSettings.gridSize[0]).fill(1))\r\n        materialMap.conductivity.push(new Array(simulationSettings.gridSize[0]).fill(0))\r\n        for (let x = 0; x < simulationSettings.gridSize[0]; x++) {\r\n            materialMap.permittivity[y].push(isLensPoint([x, y]) ? 3 : 1)\r\n        }\r\n    }\r\n\r\n    const sourceDescriptors: SourceDescriptor[] = [{\r\n        type: \"point\",\r\n        amplitude: 60000,\r\n        frequency: 2,\r\n        position: [1 / 10, 1 / 2],\r\n        turnOffTime: 0.5\r\n    }]\r\n\r\n    return {\r\n        sourceDescriptors: sourceDescriptors,\r\n        simulationSettings: simulationSettings,\r\n        materialMap: materialMap\r\n    }\r\n}","import { EncodedSimulatorMap, decodeSimulatorMap, SimulatorMap, encodeSimulatorMap } from \"./em/serialization\"\r\n\r\nconst apiUrl = \"https://6xuthl3lv4.execute-api.us-east-1.amazonaws.com/live/share\"\r\n\r\nexport async function getSharedSimulatorMap(shareId: string): Promise<SimulatorMap> {\r\n    const response = await fetch(`${apiUrl}?shareId=${shareId}`)\r\n\r\n    if (response.ok) {\r\n        const responseText = await response.text()\r\n\r\n        if (responseText) {\r\n            const encodedSimulatorMap = JSON.parse(responseText) as EncodedSimulatorMap\r\n            return decodeSimulatorMap(encodedSimulatorMap)\r\n        }\r\n    }\r\n\r\n    throw new Error(\"Invalid share\")\r\n}\r\n\r\nexport async function shareSimulatorMap(simulatorMap: SimulatorMap): Promise<string> {\r\n    const encodedSimulatorMap = encodeSimulatorMap(simulatorMap)\r\n\r\n    const response = await fetch(apiUrl, {\r\n        method: \"POST\",\r\n        mode: \"cors\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ encodedSimulatorMap: JSON.stringify(encodedSimulatorMap) })\r\n    })\r\n\r\n    if (response.ok) {\r\n        const responseObject = await response.json()\r\n        if (responseObject && responseObject.body) {\r\n            const { shareId } = JSON.parse(responseObject.body)\r\n            if (shareId) {\r\n                return shareId\r\n            }\r\n        }\r\n    }\r\n\r\n    throw new Error(\"Failed share upload\")\r\n}","import React, { useRef, useCallback, useEffect, useState, useMemo } from 'react'\nimport { EMState, createEM } from \"./em\"\nimport { makeDrawSquareInfo, makeDrawEllipseInfo, DrawShape } from \"./em/drawing\"\nimport { signalSourceToDescriptor, descriptorToSignalSource, makeMaterialMap } from './em/serialization'\nimport {\n    SideBarType, BrushType, CollapsibleContainer, SettingsComponent, ExamplesComponent,\n    MaterialBrushMenu, SignalBrushMenu, MultiMenu, MultiMenuChild, InfoBox, LoadingIndicator,\n    ShareBox, ResetButtons, BrushSelectionButtons, MenuSelectionButtons, BrushCursor, MiscButtons,\n    InteractiveCanvas, FullscreenView\n} from './components'\nimport { clamp, qualityPresets } from './util'\nimport { getSharedSimulatorMap, shareSimulatorMap } from './share'\n\nconst defaultPreset = qualityPresets[\"Medium\"]\n\nconst defaultSignalBrushValue = 10\nconst defaultSignalBrushSize = 1\nconst defaultSignalFrequency = 3\nconst defaultPermittivityBrushValue = 5\nconst defaultPermeabilityBrushValue = 1\nconst defaultConductivityBrushValue = 0\nconst defaultMaterialBrushSize = 5\nconst defaultBrushDrawShape = DrawShape.Square\n\nconst initialDt = defaultPreset.dt\nconst initialCellSize = defaultPreset.cellSize\nconst initialSimulationSpeed = 1\nconst initialGridSizeLongest = defaultPreset.gridSizeLongest\nconst initialResolutionScale = defaultPreset.resolutionScale\nconst initialWindowSize: [number, number] = [window.innerWidth, window.innerHeight]\nconst initialCanvasSize: [number, number] = calculateCanvasSize(initialWindowSize, initialResolutionScale)\nconst initialGridSize: [number, number] = calculateGridSize(initialGridSizeLongest, initialCanvasSize)\nconst initialReflectiveBoundary = false\n\nfunction calculateCanvasSize(windowSize: [number, number], resolutionScale: number): [number, number] {\n    return [Math.round(windowSize[0] * resolutionScale), Math.round(windowSize[1] * resolutionScale)]\n}\n\nfunction calculateGridSize(gridSizeLongest: number, canvasSize: [number, number]): [number, number] {\n    const canvasAspect = canvasSize[0] / canvasSize[1]\n\n    return canvasSize[0] >= canvasSize[1] ?\n        [gridSizeLongest, Math.ceil(gridSizeLongest / canvasAspect)] :\n        [Math.ceil(gridSizeLongest * canvasAspect), gridSizeLongest]\n}\n\nexport default function () {\n    const urlShareId = window.location.hash ? window.location.hash.substr(1) : null\n    const [shareId, setShareId] = useState<string | null>(urlShareId)\n\n    const drawCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const [canvasSize, setCanvasSize] = useState<[number, number]>(initialCanvasSize)\n    const [windowSize, setWindowSize] = useState<[number, number]>(initialWindowSize)\n    const [gridSizeLongest, setGridSizeLongest] = useState(initialGridSizeLongest)\n    const [dt, setDt] = useState(initialDt)\n    const [cellSize, setCellSize] = useState(initialCellSize)\n    const [resolutionScale, setResolutionScale] = useState(initialResolutionScale)\n    const [simulationSpeed, setSimulationSpeed] = useState(initialSimulationSpeed)\n    const [reflectiveBoundary, setReflectiveBoundary] = useState(initialReflectiveBoundary)\n\n    const gridSize = useMemo<[number, number]>(() => calculateGridSize(gridSizeLongest, canvasSize), [canvasSize, gridSizeLongest])\n    const [em, setEm] = useState<EMState | null>(null)\n\n    // Would use useMemo for gpu here, but useMemo does not seem to work with ref dependencies.\n    useEffect(() => {\n        if (drawCanvasRef.current) {\n            setEm(createEM(drawCanvasRef.current, initialGridSize,\n                initialCellSize, initialReflectiveBoundary, initialDt))\n        }\n    }, [drawCanvasRef])\n\n    // Window resize canvas\n    useEffect(() => {\n        const adjustCanvasSize = () => {\n            const wndSize: [number, number] = [window.innerWidth, window.innerHeight]\n            setCanvasSize(calculateCanvasSize(wndSize, resolutionScale))\n            setWindowSize(wndSize)\n        }\n\n        adjustCanvasSize()\n\n        window.addEventListener(\"resize\", adjustCanvasSize)\n        return () => window.removeEventListener(\"resize\", adjustCanvasSize)\n    }, [resolutionScale])\n\n    // Load share id\n    useEffect(() => {\n        if (em && urlShareId) {\n            setShowLoading(true)\n            console.log(`Loading ${urlShareId}`)\n            getSharedSimulatorMap(urlShareId).then(simulatorMap => {\n                // Load material\n                em.loadMaterialFromComponents(\n                    simulatorMap.materialMap.permittivity,\n                    simulatorMap.materialMap.permeability,\n                    simulatorMap.materialMap.conductivity\n                )\n\n                // Load settings\n                setDt(simulatorMap.simulationSettings.dt)\n                setGridSizeLongest(Math.max(simulatorMap.simulationSettings.gridSize[0], simulatorMap.simulationSettings.gridSize[1]))\n                setCellSize(simulatorMap.simulationSettings.cellSize)\n\n                // Load sources\n                em.setSources(simulatorMap.sourceDescriptors.map(desc => descriptorToSignalSource(desc)))\n\n                console.log(`Loaded ${urlShareId}`)\n            }).catch(err => console.error(`Error getting share ${urlShareId}: ${JSON.stringify(err)}`)).finally(() => setShowLoading(false))\n        }\n    }, [em, urlShareId])\n\n    // Update render sim output size\n    useEffect(() => {\n        if (em) {\n            em.adjustCanvasSize(canvasSize)\n            em.resetFields()\n            em.resetMaterials()\n        }\n    }, [em, canvasSize])\n\n    // Update simulator grid size\n    useEffect(() => {\n        if (em) {\n            em.setGridSize(gridSize)\n            em.resetFields()\n            em.resetMaterials()\n        }\n    }, [em, gridSize])\n\n    // Update simulator cell size\n    useEffect(() => {\n        if (em) {\n            em.setCellSize(cellSize)\n        }\n    }, [em, cellSize])\n\n    // Update reflective boundary\n    useEffect(() => {\n        if (em) {\n            em.setReflectiveBoundary(reflectiveBoundary)\n        }\n    }, [em, reflectiveBoundary])\n\n    const [signalBrushSize, setSignalBrushSize] = useState(defaultSignalBrushSize)\n    const [signalBrushValue, setSignalBrushValue] = useState(defaultSignalBrushValue)\n    const [activeBrushShape, setActiveBrushDrawShape] = useState<DrawShape>(defaultBrushDrawShape)\n\n    const [materialBrushSize, setMaterialBrushSize] = useState(defaultMaterialBrushSize)\n    const [permittivityBrushValue, setPermittivityBrushValue] = useState(defaultPermittivityBrushValue)\n    const [permeabilityBrushValue, setPermeabilityBrushValue] = useState(defaultPermeabilityBrushValue)\n    const [conductivityBrushValue, setConductivityBrushValue] = useState(defaultConductivityBrushValue)\n    const [signalFrequency, setSignalFrequency] = useState(defaultSignalFrequency)\n\n    const [activeBrush, setActiveBrush] = useState(BrushType.Signal)\n\n    const [mousePosition, setMousePosition] = useState<[number, number] | null>(null)\n\n    const signalStrength = useRef(0)\n    const mouseDownPos = useRef<[number, number] | null>(null)\n\n    const [shareInProgress, setShareInProgress] = useState(false)\n    const [sideMenuCollapsed, setSideMenuCollapsed] = useState(false)\n    const [infoVisible, setInfoVisible] = useState(false)\n    const [showLoading, setShowLoading] = useState(false)\n\n    // Snap input across a line\n    const [snapInput, setSnapInput] = useState(false)\n\n    // Convert from window location to the coordinates used\n    // by the simulator's draw function.\n    const windowToSimulationPoint = useMemo(() => {\n        return (windowPoint: [number, number]) => {\n            const simulationPoint: [number, number] = [\n                clamp(0, 1, windowPoint[0] / windowSize[0]),\n                clamp(0, 1, 1 - windowPoint[1] / windowSize[1])\n            ]\n\n            return simulationPoint\n        }\n    }, [windowSize])\n\n    // Simulate one step\n    const simStep = useCallback(() => {\n        if (em) {\n            if (mouseDownPos.current !== null) {\n                const center: [number, number] = windowToSimulationPoint(mouseDownPos.current)\n                const brushHalfSize: [number, number] = [\n                    signalBrushSize / gridSize[0] / 2,\n                    signalBrushSize / gridSize[1] / 2\n                ]\n\n                const value = -signalBrushValue * 2000 * Math.cos(2 * Math.PI * signalFrequency * em.getTime())\n\n                const drawInfo = activeBrushShape === DrawShape.Square ?\n                    makeDrawSquareInfo(center, brushHalfSize, value) :\n                    makeDrawEllipseInfo(center, brushHalfSize, value)\n\n                em.injectSignal(drawInfo, dt)\n            }\n\n            em.stepSim(dt)\n        }\n    }, [em, dt, signalFrequency, signalBrushValue, signalBrushSize, windowToSimulationPoint, activeBrushShape, gridSize])\n\n    // Change simulation speed\n    useEffect(() => {\n        if (simulationSpeed > 0) {\n            const timer = setInterval(simStep, 1000 / simulationSpeed * dt)\n            return () => clearInterval(timer)\n        }\n\n        return undefined\n    }, [simStep, dt, simulationSpeed])\n\n    // Draw one frame\n    const drawStep = useCallback(() => {\n        if (em) {\n            if (drawCanvasRef.current) {\n                const cnvSize = calculateCanvasSize([window.innerWidth, window.innerHeight], resolutionScale)\n                drawCanvasRef.current.width = cnvSize[0]\n                drawCanvasRef.current.height = cnvSize[1]\n            }\n\n            em?.renderToCanvas(true, true)\n        }\n    }, [em, resolutionScale, drawCanvasRef])\n\n    // Draw loop\n    useEffect(() => {\n        let stop = false\n        const drawIfNotStopped = () => {\n            if (!stop) {\n                drawStep()\n                requestAnimationFrame(drawIfNotStopped)\n            }\n        }\n\n        requestAnimationFrame(drawIfNotStopped)\n\n        return () => { stop = true }\n    }, [drawStep])\n\n    // Reset materials in the simulator\n    const resetMaterials = useCallback(() => {\n        if (em) {\n            em.setSources([])\n            em.resetMaterials()\n        }\n    }, [em])\n\n    // Reset fields in the simulator\n    const resetFields = useCallback(() => {\n        if (em) {\n            em.resetFields()\n            signalStrength.current = 0\n        }\n    }, [em])\n\n    const [isInputDown, setIsInputDown] = useState(false)\n\n    const activeBrushSize = useMemo(() => (activeBrush === BrushType.Signal ? signalBrushSize : materialBrushSize) * (canvasSize[0] / gridSize[0]), [activeBrush, signalBrushSize, materialBrushSize, canvasSize, gridSize])\n\n    const [sideBar, setSideBar] = useState(SideBarType.SignalBrush)\n    const [shareVisible, setShareVisible] = useState(false)\n\n    const hideWhenInputDownStyle = useMemo<React.CSSProperties>(() => isInputDown ? { pointerEvents: \"none\", opacity: 0.2 } : {}, [isInputDown])\n\n    const generateShareUrl = useCallback(() => {\n        if (em) {\n            setShareInProgress(true)\n            const material = em.getMaterial()\n            if (material) {\n                shareSimulatorMap({\n                    materialMap: makeMaterialMap(material),\n                    simulationSettings: {\n                        cellSize: cellSize,\n                        dt: dt,\n                        gridSize: gridSize,\n                        simulationSpeed: 1\n                    },\n                    sourceDescriptors: em.getSources().map(source => signalSourceToDescriptor(source))\n                })\n                    .then(shareId => setShareId(shareId))\n                    .catch(err => console.log(\"Error uploading share: \" + JSON.stringify(err)))\n                    .finally(() => setShareInProgress(false))\n            }\n        }\n    }, [dt, cellSize, gridSize, em])\n\n    const shareUrl = useMemo(() => {\n        return shareId ? `${window.location.origin}${window.location.pathname}#${shareId}` : null\n    }, [shareId])\n\n    // Open side menu when switching the side bar\n    useEffect(() => {\n        setSideMenuCollapsed(false)\n    }, [sideBar])\n\n    return <>\n        <FullscreenView>\n            <InteractiveCanvas activeBrush={activeBrush} activeBrushShape={activeBrushShape} canvasSize={canvasSize}\n                conductivityBrushValue={conductivityBrushValue} drawCanvasRef={drawCanvasRef} em={em}\n                gridSize={gridSize} materialBrushSize={materialBrushSize} mouseDownPos={mouseDownPos}\n                permeabilityBrushValue={permeabilityBrushValue} permittivityBrushValue={permittivityBrushValue}\n                setIsInputDown={setIsInputDown} setMousePosition={setMousePosition} snapInput={snapInput}\n                windowSize={windowSize} windowToSimulationPoint={windowToSimulationPoint} />\n\n            <BrushCursor mousePosition={mousePosition} activeBrushSize={activeBrushSize} brushShape={activeBrushShape} />\n\n            <MiscButtons extraStyle={hideWhenInputDownStyle} generateShareUrl={generateShareUrl}\n                infoVisible={infoVisible} setInfoVisible={setInfoVisible}\n                shareVisible={shareVisible} setShareVisible={setShareVisible} />\n            <BrushSelectionButtons activeSideBar={sideBar} setActiveSideBar={setSideBar} setActiveBrush={setActiveBrush} extraStyle={hideWhenInputDownStyle} />\n            <MenuSelectionButtons activeSideBar={sideBar} setActiveSideBar={setSideBar} extraStyle={hideWhenInputDownStyle} />\n            <ResetButtons resetFields={resetFields} resetMaterials={resetMaterials} extraStyle={hideWhenInputDownStyle} />\n\n            <CollapsibleContainer collapsed={sideMenuCollapsed} setCollapsed={setSideMenuCollapsed} title={sideBar.toString()}\n                style={{ position: \"absolute\", top: \"50%\", height: \"400px\", marginTop: \"-200px\", right: 0, opacity: 0.9, ...hideWhenInputDownStyle }}>\n                <MultiMenu activeState={sideBar}>\n                    <MultiMenuChild activateForState={SideBarType.SignalBrush}>\n                        <SignalBrushMenu\n                            signalBrushSize={signalBrushSize} setSignalBrushSize={setSignalBrushSize}\n                            signalBrushValue={signalBrushValue} setSignalBrushValue={setSignalBrushValue}\n                            signalFrequency={signalFrequency} setSignalFrequency={setSignalFrequency}\n                            activeBrushShape={activeBrushShape} setActiveBrushDrawShape={setActiveBrushDrawShape}\n                            snapInput={snapInput} setSnapInput={setSnapInput} />\n                    </MultiMenuChild>\n\n                    <MultiMenuChild activateForState={SideBarType.MaterialBrush}>\n                        <MaterialBrushMenu\n                            materialBrushSize={materialBrushSize} setMaterialBrushSize={setMaterialBrushSize}\n                            permittivityBrushValue={permittivityBrushValue} setPermittivityBrushValue={setPermittivityBrushValue}\n                            permeabilityBrushValue={permeabilityBrushValue} setPermeabilityBrushValue={setPermeabilityBrushValue}\n                            conductivityBrushValue={conductivityBrushValue} setConductivityBrushValue={setConductivityBrushValue}\n                            activeBrushShape={activeBrushShape} setActiveBrushDrawShape={setActiveBrushDrawShape}\n                            snapInput={snapInput} setSnapInput={setSnapInput} />\n                    </MultiMenuChild>\n\n                    <MultiMenuChild activateForState={SideBarType.Settings}>\n                        <SettingsComponent\n                            gridSizeLongest={gridSizeLongest} setGridSizeLongest={setGridSizeLongest}\n                            simulationSpeed={simulationSpeed} setSimulationSpeed={setSimulationSpeed}\n                            resolutionScale={resolutionScale} setResolutionScale={setResolutionScale}\n                            cellSize={cellSize} setCellSize={setCellSize}\n                            reflectiveBoundary={reflectiveBoundary} setReflectiveBoundary={setReflectiveBoundary}\n                            dt={dt} setDt={setDt}\n                            qualityPresets={qualityPresets} />\n                    </MultiMenuChild>\n\n                    <MultiMenuChild activateForState={SideBarType.Examples}>\n                        <ExamplesComponent\n                            em={em} setCellSize={setCellSize} setDt={setDt}\n                            setGridSizeLongest={setGridSizeLongest} setSimulationSpeed={setSimulationSpeed}\n                            gridSize={gridSize} dt={dt}\n                            cellSize={cellSize} simulationSpeed={simulationSpeed} />\n                    </MultiMenuChild>\n                </MultiMenu>\n            </CollapsibleContainer>\n        </FullscreenView>\n\n        <ShareBox visible={shareVisible} setVisible={setShareVisible} shareUrl={shareUrl} shareInProgress={shareInProgress} />\n        <LoadingIndicator visible={(shareVisible && (shareInProgress || !shareUrl)) || showLoading} />\n        <InfoBox visible={infoVisible} setVisible={setInfoVisible} />\n    </>\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}